(function(c){function a(s,u,t){for(var r in u){if(t||typeof s[r]==="undefined"){s[r]=u[r]}}return s}function b(r,t){var s=function(){this.initialize&&this.initialize.apply(this,arguments)};s.prototype=r||{};if(t){a(s,t)}return s}var j={};function h(v,s){var x=j;var r=v?v.split("."):[];for(var u=0,y=r.length;u<y;u++){var t=r[u];var w=x[t];if(!w){w=s||{};x[t]=w}x=w}return x}function n(t){var r=t;var v=r[r.length-1];var x=j;for(var u=0,y=r.length;u<y;u++){var s=r[u];var w=x[s];if(!w){return null}x=w}return x}var d={};var k="js/";var p=undefined;var q=true;var o=true;function l(v,x){if(!x){return}var t=x.split(".");var y=t[t.length-1];var z=v._classProvider;if(z[y]){return}var u=n(t);if(!u){if(!v._waitQueue){v._waitQueue={}}v._waitQueue[x]=undefined;var w=d[x];if(w){w.push(v);return}else{d[x]=w=[];w.push(v)}if(!q){return}var A=document.createElement("script");A.type="text/javascript";A.async=true;if(window.ActiveXObject){A.onreadystatechange=function(){if(A.readyState=="complete"||A.readyState=="loaded"){g(x)}}}else{A.onload=function(){g(x)}}var r=k+x.split(".").join("/")+".js";if(!o){r+="?"+(Date.now?Date.now():(+new Date()))}A.src=r;document.getElementsByTagName("head")[0].appendChild(A)}else{z[y]=u}}function e(w){var r=d[w];if(!r){return}for(var s=0,v=r.length;s<v;s++){var t=r[s];var u=t._waitQueue;if(!u){continue}delete u[w];l(t,w);t.checkAndRun()}delete d[w]}function g(s){var r=n(s.split("."));if(!r){return}e(s)}var f=b({initialize:function(r){r=r||"";this._packageObj=h(r);this._classProvider={};if(p){a(this._classProvider,p)}this._classObject=undefined;this._packageName=r;this._className=undefined;this._runQueue=[]},use:function(r){l(this,r);return this},checkAndRun:function(){if(this._waitQueue){for(var s in this._waitQueue){return false}delete this._waitQueue}while(true){var r=this._runQueue.shift();if(!r){break}r(this)}if(this._className){e(this._packageName+"."+this._className)}},define:function(s,r){this._runQueue.push(function(v){if(typeof s==="string"){var t=s;var w=r;var u=((typeof w!=="function")?w:w(v._classProvider));v._packageObj[t]=u;v._classProvider[t]=u;v._classProvider.This=u;v._className=t;v._classObject=u}else{var w=s;if(!v._classObject){throw new Error("must define with name first.")}var u=((typeof w!=="function")?w:w.apply(v._classObject,[v._classProvider]));if(u){a(v._classObject,u,true)}}});this.checkAndRun();return this},run:function(r){this._runQueue.push(function(s){if(typeof r!=="function"){throw Error()}r(s._classProvider)});this.checkAndRun();return this}});var i=b({initialize:function(){}});i.forName=function(r){if(!r){throw new Error("cannot find package!"+r)}var s=n(r.split("."));if(!s){throw new Error("cannot find package!"+r)}return s};i.extend=function(s,t){var u=this;var r=b(s,t);a(r.prototype,u.prototype,false);r.extend=u.extend;return r};c.Package=function(r){return new f(r)};c.Package.setupUtil=function(s,t){if(!p){p={}}var r=p[s];p[s]=t;return r};c.Package.setBaseUrl=function(r){k=r};c.Package.setAutoLoad=function(r){q=r};c.Package.setCacheEnabled=function(r){o=r};c.Package.Class=i;c.Package.classProvider=j})(window);Package("tupai.events").define("Events",function(a){return Package.Class.extend({initialize:function(b){this._events={}},fire:function(d,h){var c=this._events[d];if(c){var f;if(typeof h==="object"){f=h}else{f={val:h}}f.eventName=d;f.stop=false;for(var b=0,g=c.length;b<g;b++){if(!c[b]){continue}c[b].apply(this,[f]);if(f.stop){break}}}},fireDelegate:function(b,g,k){var d=this._events[b];if(d){var h;if(typeof k==="object"){h=k}else{h={val:k}}h.targetName=b;h.eventName=g;h.stop=false;for(var c=0,j=d.length;c<j;c++){var f=d[c];if(!f){continue}if(f[g]){f[g](h);if(h.stop){break}}}}},addEventListener:function(b,c,d){return this.on(b,c,d)},on:function(c,d,e){var b=this._events[c];if(!b){this._events[c]=b=[]}else{if(b.indexOf(d)>=0){return false}}if(e){b.unshift(d)}else{b.push(d)}return true},once:function(b,d,f){if(typeof d!=="function"){throw TypeError("listener must be a function")}var e=false;function c(){this.off(b,c);if(!e){e=true;d.apply(this,arguments)}}this.on(b,c,f)},removeEventListener:function(b,c){return this.off(b,c)},off:function(d,e){var c=this._events[d];if(!c){return}var b;if((b=c.indexOf(e))<0){return false}delete c[b];return true},removeAllEventListener:function(b){delete this._events[b]},clear:function(){this._events={}}})});Package("tupai.util").define("MemCache",function(a){return Package.Class.extend({_limit:undefined,_storage:undefined,initialize:function(b,c){this._limit=b||100000;this._overflowRemoveSize=c||(this._limit/10);this._storage=[]},setDelegate:function(b){this._delegate=b},_cacheGC:function(d){var c,f;var e=this._storage;var b=this._overflowRemoveSize;if(d){for(c=0;c<b;c++){e.shift()}}else{for(c=0;c<b;c++){e.pop()}}this._delegate&&this._delegate.didMemCacheGC&&this._delegate.didMemCacheGC(this)},push:function(b){if(this._storage.length>=this._limit){this._cacheGC(true)}this._storage.push(b);return true},unshift:function(b){if(this._storage.length>=this._limit){this._cacheGC(false)}this._storage.unshift(b);return true},clear:function(){this._storage=[]},iterator:function(e){var d=this._storage;for(var b=0,c=d.length;b<c;b++){e(d[b])}},filter:function(f){var e=this._storage;var d=[];for(var b=0,c=e.length;b<c;b++){if(f(e[b],b)){d.push(e[b])}}this._storage=d},remove:function(c){var d=this._storage;var b=d.splice(c,1);if(!b||b.length<1){return undefined}return b[0]},removeByElement:function(c){var b=this._storage.indexOf(c);return this.remove(b)},concatFirst:function(b){if(this._storage.length+b.length>this._limit){this._cacheGC(false)}this._storage=b.concat(this._storage);return true},concat:function(b){if(this._storage.length+b.length>this._limit){this._cacheGC(true)}var e=this._storage;for(var c=0,d=b.length;c<d;c++){e.push(b[c])}return true},getStorage:function(){return this._storage},swapStorage:function(b){this._storage=b},get:function(b){return this._storage[b]},size:function(){return this._storage.length}})});Package("tupai.model").define("DataSet",function(a){return Package.Class.extend({initialize:function(b,c){},iterator:function(b){},get:function(b){},size:function(){}})});Package("tupai.model.caches").use("tupai.model.DataSet").define("HashCacheDataSet",function(a){return a.DataSet.extend({initialize:function(c,g,f){a.DataSet.prototype.initialize.apply(this,arguments);if(!c){throw new Error("missing required parameter. cache")}this._cache=c;this._size=g;if(f&&f.filter){var e={};var b=f.limit;var i=0;var h=f.filter;for(var d in c){if(h(c[d],d)){e[d]=c[d];i++;if(b&&(i)>=b){break}}}this._cache=e;this._size=i}},iterator:function(d){var c=this._cache;for(var b in c){d(c[b],b)}},get:function(c){var b=this._cache;return b[c]},size:function(){return this._size}})});Package("tupai.util").define("HashUtil",function(a){return{merge:function(b,d){if(!d){return b}b=b||{};for(var c in d){if(d.hasOwnProperty(c)){b[c]=d[c]}}return b},equals:function(c,b){if(c==b){return true}if(!c||!b){return false}for(key in c){if(c[key]!=b[key]){return false}}for(key in b){if(c[key]!=b[key]){return false}}return true},clone:function(d){var b={};if(d){for(var c in d){b[c]=d[c]}}return b},getValueByName:function(f,e){if(!e){return undefined}names=f.split(".");var g=e;var b;for(var c=0,h=names.length;c<h;c++){var b=names[c];g=g[b];if(!g){return g}}return g},only:function(f,e,d){if(!e){return false}var b=true;for(var c in e){if(d.indexOf(c)<0){b=false;console.error(c+" is unknown parameter in "+f)}}return b},swap:function(f,d){var e=arguments.length;if(!f||!d){return}var b={};for(var c in d){b[c]=f[c];f[c]=d[c]}return b},require:function(e,d){if(!e){throw new Error("missing required parameter.")}for(var c=0,f=d.length;c<f;c++){var b=d[c];if(e[b]==null){throw new Error("key :"+b+" required.")}}}}});Package("tupai.util").define("HttpUtil",function(i){function k(r,o){if(!r){return o}var q=r.split("&");o=o||{};for(var p=0,t=q.length;p<t;p++){var s=q[p].split("=");o[s[0]]=decodeURIComponent(s[1])}return o}function l(p){var n="";if(typeof p!=="object"){return n}for(var o in p){var q=p[o];n+="&"+o+"="+encodeURIComponent(q)}if(n.length>0){n=n.substring(1)}return n}function b(o){if(typeof o!=="string"){return}var q=o.indexOf("#");if(q>=0){o=o.substring(0,q)}var n={};matches=o.match(/^(.*)\?(.*)$/);if(matches){o=matches[1];var p=matches[2];n=k(p,n)}return{url:o,options:n}}function a(){var o;try{o=new XMLHttpRequest()}catch(n){try{o=new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(n){try{o=new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(n){try{o=new ActiveXObject("Msxml2.XMLHTTP")}catch(n){try{o=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){throw new Error("This browser does not support XMLHttpRequest.")}}}}}return o}function g(o){var q=[],n;for(n in o){var p=o[n];if(p===undefined){continue}q.push(encodeURIComponent(n)+"="+encodeURIComponent(o[n]))}return q.join("&")}function h(q){if(typeof q==="object"&&q!==null){var r;if(q instanceof Array){r=[];for(var p=0,s=q.length;p<s;p++){r.push(h(q[p]))}}else{r={};for(var o in q){r[o]=h(q[o])}}return r}else{if(!q){return q}else{return encodeURIComponent(q)}}}function c(p,u,s,w){var v=a(),w=w||{},u=u||function(){},s=s||function(){},n=w.method||"GET",r=w.header||{},o=w.ctype||((n==="POST")?"application/x-www-form-urlencoded":""),q=w.data||"",t;v.onreadystatechange=function(){if(v.readyState===4){if(v.status>=200&&v.status<300){u(v.responseText,v)}else{s(v)}}};if(typeof q==="object"){if(w.type==="json"){q=JSON.stringify(h(q))}else{q=g(q)}}if(w.timeout){v.timeout=w.timeout}v.open(n,p,true);if(o){v.setRequestHeader("Content-Type",o)}for(t in r){v.setRequestHeader(t,r[t])}v.send(q);return v}var d=false;var j=[];var f=function(){setTimeout(function(){d=true;var n;while((n=j.shift())){c.apply(this,n.param)}},10)};if(window.addEventListener){window.addEventListener("load",f,false)}else{window.attachEvent("onload",f)}function e(n){if(!d){j.push({param:n})}else{c.apply(this,n)}}return{encode:g,parseOptionsFromQueryString:k,parseOptionsFromUrl:b,createQueryString:l,ajax:function(p,q,o,n){e([p,q,o,n])}}});Package("tupai.net").define("JsonpClient",function(a){return Package.Class.extend({initialize:function(b){this._autoIndex=true;if(b){if(b.hasOwnProperty("autoIndex")){this._autoIndex=b.autoIndex}}if(this._autoIndex){this._index=0}},_setupCallback:function(d,c,e){var b=this;window[d]=function(g){if(b._autoIndex){delete window[d]}var f={header:{},status:200,statusText:"OK",responseText:JSON.stringify(g),response:g};e&&e.didHttpRequestSuccess&&e.didHttpRequestSuccess(f,c)}},_setupScriptTag:function(b){var c=document.createElement("script");c.type="text/javascript";c.async=true;c.src=b;document.getElementsByTagName("head")[0].appendChild(c)},execute:function(c,e){if(!c){throw new Error("missing required parameter.")}var d="__tupai_jsonpCallbck";if(this._autoIndex){this._index++;d+=this._index}var b=c.getUrl();var f=c.getQueryString();if(b.indexOf("?")>0){b+="&"}else{b+="?"}b+="callback="+d;if(f){b+="&"+f}this._setupCallback(d,c,e);this._setupScriptTag(b)}})});Package("tupai.net").use("tupai.util.HashUtil").define("HttpRequest",function(a){return Package.Class.extend({initialize:function(b){a.HashUtil.require(b,["url"]);this._url=b.url;this._headers=b.headers||{};this._type=b.type;this._method=b.method;this._attributes=b.attributes;this._noFormData=!!(!this._method||this._method.match(/get/i));this._parameters=b.parameters;this._queryParameters=b.queryParameters;this._formData=b.formData},addAll:function(b){this.addParameters(b.parameters);this.addQueryParameters(b.queryParameters);this.addFormDatas(b.formDatas);this.addAttributes(b.attributes);this.addHeaders(b.headers)},addHeaders:function(b){this._headers=a.HashUtil.merge(this._headers,b)},addAttributes:function(b){this._attributes=a.HashUtil.merge(this._attributes,b)},addParameters:function(b){this._parameters=a.HashUtil.merge(this._parameters,b)},addQueryParameters:function(b){this._queryParameters=a.HashUtil.merge(this._queryParameters,b)},addFormDatas:function(b){this._formData=a.HashUtil.merge(this._formData,b)},getUrl:function(){return this._url},getType:function(){return this._type},getHeaders:function(){return this._headers},getQueryData:function(){if(this._noFormData&&this._parameters){return a.HashUtil.merge(this._parameters,this._queryParameters)}else{return this._queryParameters}},getQueryString:function(){var d="";var b=this.getQueryData();if(b){for(var c in b){var e=b[c];if(e===undefined){continue}d+=c+"="+encodeURIComponent(e)+"&"}}if(d.length>1){return d.substring(0,d.length-1)}else{return null}},getAttributes:function(){return this._attributes},getAttribute:function(b){if(!this._attributes){return undefined}else{return this._attributes[b]}},getParameters:function(){return this._parameters},getParameter:function(b){if(!this._parameters){return undefined}else{return this._parameters[b]}},getData:function(){if(!this._noFormData&&this._parameters){return a.HashUtil.merge(this._parameters,this._formData)}else{return this._formData}},setRequestName:function(b){this._requestName=b},getRequestName:function(){return this._requestName},getName:function(){return this._name},setName:function(b){this._name=b},getName:function(){return this._name},getMethod:function(){return this._method}})});Package("tupai.util").define("CommonUtil",function(g){var e=document.createElement("div");var c,a;if(!e.dataset){var i=function(l){return l.replace(/([A-Z])/g,function(n){return"-"+n.toLowerCase()})};var h=function(q){var p=q.split("-");for(var l=1,r=p.length;l<r;l++){var o=p[l];if(!o[0]){continue}p[l]=o[0].toUpperCase()+o.substring(1)}return p.join("")};c=function(r,p){var n="data-";var o=r.attributes;var q=n+i(p);var l=o[q];return l&&l.value};a=function(q,s){var w=q.attributes;var p={};var u;if(s){u=new RegExp(s)}for(var r=0,o=w.length;r<o;r++){var t=w[r];var l=t.name;if(/^data-/.test(l)){var v=h(l.substring(5));if(u&&!u.test(v)){continue}p[v]=t.value}}return p}}else{c=function(n,l){return n.dataset[l]};a=function(o,r){if(!r){return o.dataset}var n={};var p=o.dataset;var q=new RegExp(r);for(var l in p){if(!q.test(l)){continue}n[l]=p[l]}return n}}var j=!!e.classList;var f=function(){var n=Array.prototype.slice.call(arguments);var o=n.shift(),l=n.shift();return function(){return o.apply(l,n.concat(Array.prototype.slice.call(arguments)))}};var k=function(l){if(!l){return false}return !!l.match(/^(https?|ftp)(:\/\/[-_.!~*\'()a-zA-Z0-9;\/?:\@&=+\$,%#]+)$/)};var d=function(l){if(!l){return false}return !!l.match(/^(https?)(:\/\/[-_.!~*\'()a-zA-Z0-9;\/?:\@&=+\$,%#]+)$/)};var b;if(String.prototype.trim){b=function(l){return l.trim()}}else{b=function(l){return l.replace(/(^\s+)|(\s+$)/g,"")}}return{bind:f,isValidUrl:k,isValidHttpUrl:d,haveClassList:j,trim:b,getDataSets:a,getDataSet:c}});Package("tupai.ui").use("tupai.util.CommonUtil").use("tupai.util.HashUtil").define("TemplateEngine",function(e){var g=function(o,j){if(!o){throw new Error("loopChName failed. because element is undefined")}var n=o.querySelectorAll("*[data-ch-name]");for(var l=0,h=n.length;l<h;++l){var p=n[l];var k=e.CommonUtil.getDataSet(n[l],"chName");j(k,p,o)}var k=e.CommonUtil.getDataSet(o,"chName");if(k){j(k,o,o)}};var a=function(i,h){if(!i){throw new Error("bindToElement failed. because element is undefined")}g(i,function(j,l){var k=e.HashUtil.getValueByName(j,h);f(l,k)})};var d=function(i,j,l){if(i){a(i,l);return i}else{if(j){var n="div";if(j.match(/^<(tr|th)/)){n="tbody"}else{if(j.match(/^<(tbody|thead)/)){n="table"}}var h=document.createElement(n);h.innerHTML=j;var k=h.children[0];a(k,l);return k}else{return document.createElement("div")}}};var c=function(i,h){h=h||{};g(i,function(j,l){var k=b(l);h[j]=k});return h};var f=function(r,s){if(r.length!==undefined){var t;if(s instanceof Array){t=s}else{if(typeof s==="object"){var k=s;var p=k.fields;var o="";if(p){p.forEach(function(i){o+='<option value="'+i.value+'">'+i.text+"</option>"})}r.innerHTML=o;return f(r,k.value)}else{t=[s]}}for(var l=0,j=r.length;l<j;l++){var q=r[l];if(t.indexOf(q.value)!=-1){q.selected=true}else{q.selected=false}}}else{if(r.value!==undefined){if(/radio|checkbox/.test(r.type)){r.checked=s}else{r.value=((s===undefined)?"":s)}}else{if(r.src!==undefined){if(s!==undefined){r.src=s}else{r.removeAttribute("src")}}else{if(r.tagName==="A"){var h=s;if(typeof s==="object"){h=s.href;r.innerHTML=(s.text===undefined?"":s.text)}if(h!==undefined){r.href=h}else{r.removeAttribute("href")}}else{if(s===undefined){r.innerHTML=""}else{r.innerHTML=((s===undefined)?"":s)}}}}}};var b=function(i){if(!i){return null}if(i.length){if(i.getAttribute("multiple")){var h=[];Array.prototype.forEach.call(i,function(j){if(j.selected){h.push(j.value)}});return h}else{return i.value}}else{if(i.value!==undefined){if(/radio|checkbox/.test(i.type)){return i.checked}else{return i.value}}else{if(i.src!==undefined){return i.src}else{if(i.tagName==="A"){return{href:i.getAttribute("href"),value:i.innerHTML}}else{return i.innerHTML}}}}return null};return{createElement:d,getBindedValue:c,setValue:f,getValue:b}});Package("tupai.ui").define("ViewEvents",function(b){var c=function(f,e,g,d){if(!f||!e||!g){throw new Error("missing required parameters")}return f.addEventListener(e,g,d)};var a=function(e,d,f){if(!e||!d||!f){throw new Error("missing required parameters")}return e.removeEventListener(d,f)};return{bind:c,unbind:a}});Package("tupai").use("tupai.util.HashUtil").define("TransitManager",function(a){return Package.Class.extend({_delegate:undefined,initialize:function(c,b){var f,g;if(!b){throw new Error("missing transit_rules.")}this._history=[];this._titles={};this._window=c;this._rootController=undefined;this._controllerRefs={};for(f in b){var e=f.replace(/\*/g,"\\w*");var j=e+"$";var d=b[f];var h;if(typeof d==="string"){h=d}else{if(typeof d==="function"){h=d}else{h=d.classzz;this._titles[e]=d.title}}this._controllerRefs[j]={classzz:h}}},setDelegate:function(b){this._delegate=b},_getController:function(d){var c,e;for(c in this._controllerRefs){if(d.match(c)){e=this._controllerRefs[c];if(!e.instance){var f=e.classzz;if(typeof(f)==="string"){var b=Package.Class.forName(f);e.instance=new b(this._window)}else{if(typeof(f)==="function"){e.instance=new e.classzz(this._window)}else{throw new Error("cannot create view controller["+f+"]")}}}return e.instance}}return undefined},getTitle:function(b){if(typeof b!=="string"){return""}return this._titles[b]||b},setTitle:function(c,d){if(typeof c!=="string"){return undefined}var b=this._titles[c];this._titles[c]=d;return b},getHistories:function(){var b=[];for(var d=0,j=this._history.length;d<j;d++){var e=this._history[d];var f=this._titles[e.url]||e.url;b.push({backToIndex:j-d,url:e.url,options:e.options,transitOptions:e.transitOptions,title:f})}var g=this._current;if(g){var f=this._titles[g.url]||g.url;b.push({backToIndex:0,isCurrent:true,url:g.url,options:g.options,transitOptions:g.transitOptions,title:f})}return b},size:function(){return this._history.length},lastIndexOf:function(d){if(!d){return -1}var c=this._history;for(var b=c.length-1;b>=0;b--){if(c[b].url==d){return b}}return -1},indexOf:function(e){if(!e){return -1}var c=this._history;for(var b=0,d=c.length;b<d;b++){if(c[b].url==e){return b}}return -1},_removeUntil:function(c){if(!c){return}var b;do{b=this._history.pop();if(!b||b.url==c){break}}while(1);return b},back:function(e,b,c){var d;if(e){d=this._removeUntil(e);if(!d){c=c||{};c.newTransit=true;d={url:e,options:b}}}else{d=this._history.pop()}return this._back(d,c)},backTo:function(b){if(b<1||b>this._history.length){return 0}var c;while(b>0){c=this._history.pop();b--}return this._back(c)},_back:function(f,e){if(!f){return 0}var d=f.url;var c=f.options;e=e||{};e.transitType=2;var b=this._transit(d,c,e);this._current=f;if(b){return e.newTransit?2:1}else{return 0}},transitWithHistory:function(c,b,d){if(!this._current){throw new Error("can't transit with history.")}d=d||{};d.transitType=1;var e=this._current;if(this._transit(c,b,d)){this._history.push(e);return true}else{return false}},_currentRoute:undefined,_current:undefined,_computeTransitRoute:function(d){if(!d||d.length<1){return null}var c=d.replace(/(^\s+)|((\/|\s)+$)/g,"").split("/");if(c.length<2){return null}var b=this._currentRoute;this._currentRoute=c;if(!b){return{root:c[0],path:c.slice(1)}}var f=b.length>c.length?c.length:b.length;if(f===0){return null}var e=1;for(;e<f;e++){if(b[e]!=c[e]){break}}if(e==f&&b.length==c.length){return{root:c.slice(0,c.length-1).join("/"),path:c.slice(c.length-1)}}return{root:c.slice(0,e).join("/"),path:c.slice(e)}},transit:function(c,b,d){c=c||"/root";return this._transit(c,b,d)},_transit:function(c,q,k){q=q||{};if(this._current&&this._current.url==c&&a.HashUtil.equals(this._current.options,q)){return false}var l=this._computeTransitRoute(c);if(l==null){return false}var p=(l.root?this._getController(l.root):this._window);var o=l.root;k=k||{};var e=function(i){if(i){(i.viewInit&&i.viewInit(q,c,k))}if(!p.transitController){throw new Error("container controller must have transitController delegate function. "+c)}p.transitController(i,j,q,k)};if(o===""){var g=this._rootController;if(g===undefined){this._rootController=g=this._getController("/");if(!g){this._rootController=null}else{e(g);p=g}}else{if(g){p=g}}}for(var f=0,d=l.path.length;f<d;f++){var b=l.path[f];var j=o+"/"+b;var h=this._getController(j);e(h);if(!h){break}p=h;o=j}this._current={url:c,options:q};return true}})});Package("tupai").use("tupai.util.HttpUtil").use("tupai.TransitManager").define("PushStateTransitManager",function(a){return a.TransitManager.extend({_delegate:undefined,initialize:function(b,e,c){a.TransitManager.prototype.initialize.apply(this,arguments);this._separator=(c&&c.separator)||"#!";var d=this;this._popEventHanlder=undefined;this._addPopStateEventListener=function(){window.addEventListener("popstate",function(j){var k=j.state;if(!k||!k.url){var h=window.location.href;var i=d._parseFromLocation();if(d._current){var f=a.TransitManager.prototype.transitWithHistory.apply(d,[i.url,i.options]);if(f){d._replaceState()}}return}var h=k.url;var g=d._popEventHanlder;if(g){delete d._popEventHanlder;g();return}d._history=k.history||[];d._transit(h,k.options,k.transitOptions)});d._addPopStateEventListener=function(){}}},back:function(e,c,d){this._lastSize=this.size();var b=a.TransitManager.prototype.back.apply(this,arguments);return b},backTo:function(e,c,d){this._lastSize=this.size();var b=a.TransitManager.prototype.backTo.apply(this,arguments);return b},_back:function(f,d){if(!f){return 0}var e=this;var c=function(){var h=a.TransitManager.prototype._back.apply(e,[f,d]);e._replaceState();return h};var g=this.size()-this._lastSize;var b=d&&d.newTransit;if(b){if(g===0){return c()}}else{window.history.go(g);return 1}this._popEventHanlder=function(){c()};window.history.go(g);return b?2:1},_replaceState:function(){window.history.replaceState({url:this._current.url,options:this._current.options,transitOptions:this._current.transitOptions,history:this._history},"",this._createUrl(this._current.url,this._current.options))},transitWithHistory:function(d,c,e){var b=a.TransitManager.prototype.transitWithHistory.apply(this,arguments);if(b){window.history.pushState({url:d,options:c,transitOptions:e,history:this._history},"",this._createUrl(d,c))}return b},_createUrl:function(d,c){var b=a.HttpUtil.createQueryString(c);if(b.length>0){if(d.indexOf("?")<0){d+="?"}d+=b}return this._separator+d},_parseFromLocation:function(){var b=function(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};var d=new RegExp("^(.*)"+b(this._separator)+"(.*)");var c=(window.location.href+"").match(d);if(c){return a.HttpUtil.parseOptionsFromUrl(c[2])}},transit:function(d,c,e){if(e&&e.entry){var f=this._parseFromLocation();if(f){d=f.url;c=f.options}var g=window.history.state;if(g){this._history=g.history}}var b=a.TransitManager.prototype.transit.apply(this,[d,c,e]);if(b){this._replaceState()}if(e&&e.entry){this._addPopStateEventListener()}return b}})});Package("tupai.animation").use("tupai.util.HashUtil").define("TransitAnimation",function(a){return Package.Class.extend({initialize:function(b){this._options=b},startCSSAnimation:function(c,d,g){if(this._animating){return}this._animating=true;var e={};this.setupCSSAnimation(c,d,e);var i=function(){f()};c._element.addEventListener("webkitTransitionEnd",i,false);var b=setTimeout(f,this.getCleanupTimeOut());var h=this;function f(j){clearTimeout(b);c._element.removeEventListener("webkitTransitionEnd",i,false);h.cleanupCSSAnimation(c,d,e);g&&g.didAnimationEnd&&g.didAnimationEnd(h)}},cleanupCSSAnimation:function(b,c,e){var d=e.currentStyle;b.css({"-webkit-transition-duration":null,"-webkit-transition-property":null,"-webkit-transform":null});c.css({position:d.position||null,"overflow-y":d["overflow-y"]||null,left:d.left,top:d.top})},setupCSSAnimation:function(b,c,d){d.currentStyle={};d.currentStyle["overflow-y"]=c.css("overflow-y");d.currentStyle.top=c.css("top")||"0px";d.currentStyle.left=c.css("left")||"0px";d.currentStyle.position=c.css("position");c.css({position:"absolute",top:"0px",left:direction==="right2left"?(1*window.innerWidth)+"px":(-1*window.innerWidth)+"px","overflow-y":"hidden"});b.css({"-webkit-transition-property":"-webkit-transform","-webkit-transition-duration":300,"-webkit-transform":"translate3d("+(direction==="right2left"?(-1*window.innerWidth)+"px":window.innerWidth+"px")+", 0, 0)"})},getCleanupTimeOut:function(){return 500}})});Package("tupai.animation").use("tupai.util.HashUtil").define("Transition",function(a){return Package.Class.extend({initialize:function(b){this._options=b},getTransformation:function(){return{alpha:{},matrix:{}}},startCSSAnimation:function(c,e){this.setupCSSAnimation(c);var g=function(){d()};this._element.addEventListener("webkitTransitionEnd",g,false);var b=setTimeout(d,this.getCleanupTimeOut());var f=this;function d(h){clearTimeout(b);c._element.removeEventListener("webkitTransitionEnd",g,false);f.cleanupCSSAnimation(c);e&&e.didAnimationEnd&&e.didAnimationEnd(f)}},cleanupCSSAnimation:function(b){b.css({"-webkit-transition-duration":null,"-webkit-transition-property":null,"-webkit-transform":null});if(b._children.length>1){var c=b.getChildAt(0);c.clearFromParent()}},setupCSSAnimation:function(b){b.css({"-webkit-transition-property":"-webkit-transform","-webkit-transition-duration":300,"-webkit-transform":"translate3d("+(direction==="right2left"?(-1*window.innerWidth)+"px":window.innerWidth+"px")+", 0, 0)"})},getCleanupTimeOut:function(){return 500}})});Package("tupai.ui").use("tupai.util.HttpUtil").define("Templates",function(a){return Package.Class.extend({initialize:function(b){if(!b){throw new Error("missing required parameters.")}if(b.html){this._parseHtml(b.html)}else{if(b.url){var d=this;this._loading=true;a.HttpUtil.ajax(b.url,function(e){try{d._parseHtml(e)}finally{d._loading=false}},function(e){d._loading=false;b.error&&b.error(e)})}else{if(b.element){this._parseHtml(b.element.outerHTML)}else{if(b.elementId){var c=document.getElementById(b.elementId);if(c){this._parseHtml(c.outerHTML)}else{throw new Error("cannot find ["+b.elementId+"] to create Templates")}}}}}},_parseHtml:function(k){var l=document.createElement("div");l.innerHTML=k;var b=l.querySelectorAll("*[data-ch-template]");var n={};for(var e=0,j=b.length;e<j;++e){var f=b[e];var d=f.getAttribute("data-ch-template");if(!d){continue}f.removeAttribute("data-ch-template");var h=true;var c=f.getAttribute("data-ch-include-sub-templates");if(c){f.removeAttribute("data-ch-include-sub-templates");if(c==="true"){h=false}}if(h){f=f.cloneNode(true);this._removeSubTemplates(f)}var g=f.outerHTML;n[d]=g}this._templates=n;this._onReady()},_removeSubTemplates:function(g){var d=g.getElementsByTagName("*");var c=[];for(var f=0,j=d.length;f<j;f++){var b=d[f];if(!b){continue}var e=b.getAttribute("data-ch-template");if(!e){continue}c.push(b)}for(var f=0,j=c.length;f<j;f++){var h=c[f];h.parentNode.removeChild(h)}},_onReady:function(){this._ready=true;if(this._templates&&this._waitingQueue){while(true){var b=this._waitingQueue.shift();if(!b){break}b.callback&&b.callback(this._templates[b.id])}}},get:function(d,c){if(this._ready){var b=this._templates[d];c&&c(b);return b}else{if(!this._waitingQueue){this._waitingQueue=[]}this._waitingQueue.push({id:d,callback:c});return undefined}}})}).define(function(a){return({register:function(c,b){if(!a.Templates.instances){a.Templates.instances={}}a.Templates.instances[c]=new a.Templates(b)},getInstance:function(b){if(!a.Templates.instances){return undefined}else{return a.Templates.instances[b]}},getTemplate:function(c,d,e){var b=a.Templates.getInstance(c);if(!b){return undefined}return b.get(d,e)}})});Package("tupai.util").define("LinkedList",function(a){return Package.Class.extend({_root:undefined,_last:undefined,initialize:function(){this._size=0},_add:function(d,c,b){if(!this._last){this._root=d;this._last=c}else{if(b){c.next=this._root;this._root.prev=c;this._root=d}else{this._last.next=d;d.prev=this._last;this._last=c}}},push:function(c){var b={data:c,next:undefined,prev:undefined};this._add(b,b,false);this._size++},unshift:function(c){var b={data:c,next:undefined,prev:undefined};this._add(b,b,true);this._size++},clear:function(){this._root=undefined;this._last=undefined;this._size=0},iterator:function(d){var b=this._root;while(b){d(b.data);b=b.next}},_findByData:function(b){var c=this._root;while(c){if(b===c.data){return c}c=c.next}},_findByIndex:function(b){if(b<0||b>=this._size){return undefined}var c=this._root;while(c){if(b==0){return c}c=c.next;b--}},_remove:function(c,b){if(c.prev){if(b.next){c.prev.next=c.next;b.next.prev=b.prev}else{this._last=c.prev;this._last.next=undefined}}else{if(b.next){this._root=b.next;this._root.prev=undefined}else{this._root=this._last=undefined}}},removeByElement:function(c){var b=this._findByData(c);if(!b){return undefined}this._remove(b,b);this._size--;return c},removeByIndex:function(b){var c=this._findByIndex(b);if(!c){return undefined}this._remove(c,c);this._size--;return c.data},pop:function(){return this.removeLast()},shift:function(){return this.removeFirst()},removeFirst:function(){if(!this._root){return}var b=this._root.data;this._root=this._root.next;if(!this._root){this._last=undefined}else{this._root.prev=undefined}this._size--;return b},removeLast:function(){if(!this._last){return}var b=this._last.data;this._last=this._last.prev;if(!this._last){this._root=undefined}else{this._last.next=undefined}this._size--;return b},filter:function(f){var d=this._root;var e,c,b=0;while(d){if(!f(d.data,b)){if(!e){e=d}b++}else{if(e){this._remove(e,d.prev);this._size-=b;e=undefined;b=0}}c=d;d=d.next}if(e){this._remove(e,c);this._size-=b}},_createNode:function(b){var f,d,h;var g=b.length;for(var e=0;e<g;e++){h={data:b[e],next:undefined,prev:undefined};if(!d){f=d=h}else{d.next=h;h.prev=d;d=h}}if(f&&d){return{root:f,last:d,count:g}}else{return undefined}},concatFirst:function(b){var c=this._createNode(b);if(c){this._add(c.root,c.last,true);this._size+=c.count}},concat:function(b){var c=this._createNode(b);if(c){this._add(c.root,c.last,false);this._size+=c.count}},get:function(b){if(b<0||b>=this._size){return undefined}var c=this._findByIndex(b);return c?c.data:undefined},size:function(){return this._size}})});Package("tupai.util").define("UserAgent",function(i){var n=false,b,h,f,c,g,e,j,k,a,d;function l(){if(n){return}n=true;var q=navigator.userAgent;var p=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))/.exec(q);j=/\b(iPhone|iP[ao]d)/.exec(q);if(j){var o=q.match(/OS ([_\d\.]+)/);if(o&&o.length>1){j=parseFloat(o[1].split("_").join("."))}else{j=1}}k=/\b(iP[ao]d)/.exec(q);e=/Android (\d+(?:\.\d+)+)(-\w+)?;/i.exec(q);a=/Mobile/i.exec(q);e=e&&parseFloat(e[1]);if(e){d=/Android (\d+(?:\.\d+)+)(-\w+)?; (\w{2,3})\-(\w{2,3});\s([^\/]+)\sBuild/i.exec(q);if(d){d=d[5]}}if(p){b=p[1]?parseFloat(p[1]):NaN;if(b&&document.documentMode){b=document.documentMode}h=p[2]?parseFloat(p[2]):NaN;f=p[3]?parseFloat(p[3]):NaN;c=p[4]?parseFloat(p[4]):NaN;if(c){p=/(?:Chrome\/(\d+\.\d+))/.exec(q);g=p&&p[1]?parseFloat(p[1]):NaN}else{g=NaN}}else{b=h=f=g=c=NaN}}return{ie:function(){return l()||b},firefox:function(){return l()||h},opera:function(){return l()||f},safari:function(){return l()||c},chrome:function(){return l()||g},iphone:function(){return l()||j},mobile:function(){return l()||(j||k||e||a)},android:function(){return l()||e},device:function(){return l()||d},ipad:function(){return l()||k}}});Package("tupai.model.caches").use("tupai.model.DataSet").define("QueueCacheDataSet",function(a){return a.DataSet.extend({initialize:function(c,e){a.DataSet.prototype.initialize.apply(this,arguments);if(!c){throw new Error("missing required parameter. cache")}this._cache=c;if(e&&e.filter){var d=[];var b=e.limit;var h=0;var g=e.filter;for(var f=0,j=c.size();f<j;f++){if(g(c.get(f),f)){d.push(c.get(f));h++;if(b&&(h)>=b){break}}}this._newCache=d}},iterator:function(e){if(this._newCache){var d=this._newCache;for(var b=0,c=d.length;b<c;b++){e(d[b])}}else{this._cache.iterator.apply(this._cache,arguments)}},get:function(c){if(this._newCache){var b=this._newCache;return b[c]}else{return this._cache.get.apply(this._cache,arguments)}},size:function(){if(this._newCache){return this._newCache.length}else{return this._cache.size.apply(this._cache,arguments)}}})});Package("tupai.model.caches").use("tupai.model.caches.HashCacheDataSet").define("HashCache",function(a){return Package.Class.extend({_storage:null,initialize:function(e,b,f){b=b||{};this._idField=b.idField||"id";this._unique=b.unique;this._storage={};this._attributes=b.attributes;this._size=0;if(b.memCache){var i=b.memCache;this._limit=i.limit;this._overflowRemoveSize=i.overflowRemoveSize;if(!this._overflowRemoveSize){this._overflowRemoveSize=this._limit/10}}if(b.localStorage){this._nativeStorage=window.localStorage;this._nativeStorageDefaultMeta={version:1}}else{if(b.sessionStorage){this._nativeStorage=window.sessionStorage;this._nativeStorageDefaultMeta={version:1}}}if(this._nativeStorage){this._nativeStorageKey="__tupai_"+e;var g=this._nativeStorage.getItem(this._nativeStorageKey);if(g){var h=JSON.parse(g);if(h.m&&h.d){this._storage=h.d;this._meta=h.m}else{console.warn("unknow native storage format!")}}for(var e in this._storage){this._size++}}this._delegate=f;this._name=e},notifyDataSetChanged:function(b){this._saveToNative();this._delegate&&this._delegate.didCacheChanged&&this._delegate.didCacheChanged(this._name,this,b)},getCreated:function(){return this._meta&&this._meta.created},end:function(b){this.notifyDataSetChanged(b)},getAttribute:function(b){return this._attributes&&this._attributes[b]},setAttribute:function(c,d){if(!this._attributes){this._attributes={}}var b=this._attributes[c];this._attributes[c]=d;return b},query:function(b){var c=new a.HashCacheDataSet(this._storage,this._size,b);return c},_saveToNative:function(){if(this._nativeStorage){var c=this._meta;if(!c){c=this._meta={};for(var b in this._nativeStorageDefaultMeta){c[b]=this._nativeStorageDefaultMeta[b]}}c.created=(Date.now?Date.now():(+new Date()));var e={m:c,d:this._storage};this._nativeStorage.setItem(this._nativeStorageKey,JSON.stringify(e))}},_cacheGC:function(){var b=this._overflowRemoveSize||100;for(var d=0;d<b;d++){L1:while(1){for(var c in this._storage){if(parseInt(Math.random()*3)==0){delete this._storage[c];this._size--;break L1}}}}this._saveToNative();this._delegate&&this._delegate.didCacheGC&&this._delegate.didCacheGC(this._name,this)},getName:function(){return this._name},getId:function(b){return b[this._idField]},_push:function(b){var c=this.getId(b);if(c==undefined){throw new Error("can't get "+this._idField+" from data.")}if(!this._storage.hasOwnProperty(c)){if(this._limit&&this._size>=this._limit){this._cacheGC()}this._size++}else{if(this._unique){throw new Error("duplicate key. "+c)}}this._storage[c]=b},push:function(c){if(c instanceof Array){for(var b=0,d=c.length;b<d;b++){this._push(c[b])}}else{this._push(c)}},filter:function(e,b){var d=false;var c;for(c in this._storage){if(!e(this._storage[c],c)){d=true;delete this._storage[c];this._size--}}if(!b&&d){this.notifyDataSetChanged({action:"filter"})}},unshift:function(b){this.push(b)},iterator:function(c){for(var b in this._storage){c(this._storage[b],b)}},remove:function(c){var b=this._storage[c];if(this._storage.hasOwnProperty(c)){delete this._storage[c];this._size--}return b},removeByElement:function(b){if(!b){return undefined}var c=this.getId(b);if(this._storage[c]===b){return this.remove(c)}return undefined},clear:function(){this._storage={};this._size=0},get:function(b){return this._storage[b]},size:function(){return this._size}})});Package("tupai.net").use("tupai.util.HttpUtil").define("HttpClient",function(a){return Package.Class.extend({initialize:function(b){if(b){this._defaultRequestHeaders=b.defaultRequestHeaders;this._fixAjaxCache=!!b.fixAjaxCache;this._defaultRequestType=b.defaultRequestType;this._timeout=b.timeout}if(!this._defaultRequestHeaders){this._defaultRequestHeaders={Accept:"application/json",Pragma:"no-cache","Cache-Control":"no-cache","If-Modified-Since":"Thu, 01 Jun 1970 00:00:00 GMT"}}},_mergeDefault:function(b,d){d=d||{};if(b){for(var c in b){d[c]=b[c]}}return d},_getResponseFromXhr:function(c,b){return{header:c.getAllResponseHeaders(),status:c.status,statusText:c.statusText,responseText:b}},_execute:function(f,i){var c=f.getUrl();var b=f.getQueryString();if(b){if(c.indexOf("?")>0){c+="&"}else{c+="?"}c+=b}var k=this._mergeDefault(this._defaultRequestHeaders,f.getHeaders());var g=f.getMethod();var e=f.getData();var h=f.getType()||this._defaultRequestType;if(this._fixAjaxCache&&(!g||g.toLowerCase()==="get")){var d="__t="+(Date.now?Date.now():(+new Date()));if(c.indexOf("?")>0){c+="&"}else{c+="?"}c+=d}var j=this;return a.HttpUtil.ajax(c,function(n,o){var l=j._getResponseFromXhr(o,n);i&&i.didHttpRequestSuccess&&i.didHttpRequestSuccess(l,f)},function(n){var l=j._getResponseFromXhr(n);i&&i.didHttpRequestError&&i.didHttpRequestError(l,f)},{method:g,data:e,type:h,header:k,timeout:this._timeout})},execute:function(b,c){if(!b){throw new Error("missing required parameter.")}return this._execute(b,c)}})});Package("tupai.ui").use("tupai.util.CommonUtil").use("tupai.util.HashUtil").use("tupai.events.Events").use("tupai.ui.TemplateEngine").use("tupai.ui.ViewEvents").define("View",function(a){return Package.Class.extend({_children:undefined,_rendered:undefined,_element:undefined,_baseViewDelegate:undefined,_events:undefined,initialize:function(b){this._children=[];this._events=undefined;this._didLoadFlg=false;this._viewIDMap=undefined;this._spViews=undefined;this._templateEngine=a.TemplateEngine;this._viewEvents=a.ViewEvents;if(b){this._template=b.template;this._templateParameters=b.templateParameters}},fire:function(b,d){if(!this._events){return}var c=d||{};c.target=this;c.stopParent=false;this._events.fire(b,c);if(!c.stopParent&&this._parent){this._parent.fire(name,c)}},on:function(){if(!this._events){this._events=new a.Events()}this._events.on.apply(this._events,arguments)},once:function(){if(!this._events){this._events=new a.Events()}this._events.once.apply(this._events,arguments)},addEventListener:function(){if(!this._events){this._events=new a.Events()}this._events.addEventListener.apply(this._events,arguments)},off:function(){if(!this._events){return}this._events.off.apply(this._events,arguments)},removeEventListener:function(){if(!this._events){return}this._events.removeEventListener.apply(this._events,arguments)},setDelegate:function(b){this._baseViewDelegate=b},iterateChildren:function(e){for(var b=0,d=this._children.length;b<d;b++){var c=this._children[b];e(c)}},render:function(b){if(!this._rendered){if(!this._parent){throw new Error("no parent.")}this._parent.render(b)}this._onChildrenRender(b)},_onHTMLRender:function(b,c){if(this._rendered){return false}this._checkElement();if(this.willRender){this.willRender()}if(!this._parentAdded){b.appendChild(this._element);this._parentAdded=true;this.bindEvents(this._baseViewDelegate)}this._didRender();return true},_didRender:function(){this._rendered=true;if(this.didRender){this.didRender()}if(this._baseViewDelegate&&this._baseViewDelegate.viewDidRender){this._baseViewDelegate.viewDidRender(this)}this.fire("didRender")},_didLoad:function(){if(this.didLoad){this.didLoad()}if(this._baseViewDelegate&&this._baseViewDelegate.viewDidLoad){this._baseViewDelegate.viewDidLoad(this)}this.fire("didLoad");this._didLoadFlg=true},_onChildrenRender:function(d){var b=this._element;var c=function(j){if(!j){return}var i=j._onHTMLRender(b,d);j._onChildrenRender(d);if(i){j._didLoad()}};for(var e=0,h=this._children.length;e<h;e++){var g=this._children[e];c(g)}if(this._viewIDMap){for(var f in this._viewIDMap){c(this._viewIDMap[f])}}if(this._spViews){for(var e=0,h=this._spViews.length;e<h;e++){c(this._spViews[e])}}},getTemplate:function(){if(typeof this._template==="function"){return this._template()}else{return this._template}},getTemplateParameters:function(){if(typeof this._templateParameters==="function"){return this._templateParameters()}else{return this._templateParameters}},_createViewIDMap:function(){if(this._viewIDMap){return}var e=function(n){var l=a.CommonUtil.getDataSet(g[f],"chView");var k;if(l){var i=Package.Class.forName(l);k=new i()}else{k=new a.View()}k._element=n;k._parent=this;k._parentAdded=true;return k};var d={};var g=this._element.querySelectorAll("*[data-ch-id]");for(var f=0,c=g.length;f<c;++f){var j=g[f];var h=a.CommonUtil.getDataSet(g[f],"chId");if(!h){continue}d[h]=e(j)}var b=[];var g=this._element.querySelectorAll("*[data-ch-view]");for(var f=0,c=g.length;f<c;++f){var j=g[f];var h=a.CommonUtil.getDataSet(g[f],"chId");if(h){continue}b.push(e(j))}this._viewIDMap=d;this._spViews=(b.length>0?b:undefined)},_checkElement:function(){if(this._element){return}var b=this.getTemplate();var c=this.getTemplateParameters();this._element=this._templateEngine.createElement(undefined,b,c);if(!this._element){throw new Error("cannot create element")}this._createViewIDMap()},setTemplateParameters:function(c){this._templateParameters=c;if(this._element){var b=this.getTemplate();var d=this.getTemplateParameters();this._element=this._templateEngine.createElement(this._element,b,d)}},setData:function(b){this.setTemplateParameters(b)},getData:function(){var b=this.getTemplateParameters();if(this._element){return this._templateEngine.getBindedValue(this._element,b)}else{return b}},setValue:function(b){this._checkElement();return this._templateEngine.setValue(this._element,b)},getValue:function(){this._checkElement();return this._templateEngine.getValue(this._element)},addSubView:function(b){this._children.push(b);b._parent=this;if(typeof b.onAppendedToParent==="function"){b.onAppendedToParent()}},getChildAt:function(b){if(b<0||b>=this._children.length){return null}else{return this._children[b]}},findViewById:function(b){this._checkElement();return(this._viewIDMap&&this._viewIDMap[b])},getChildrenSize:function(){return this._children.length},clearChildren:function(){if(this._viewIDMap){for(var e in this._viewIDMap){var d=this._viewIDMap[e];d.clearChildren();this._removeChild(d)}this._viewIDMap={};if(this._spViews){for(var b=0,c=this._spViews.length;b<c;b++){var d=this._spViews[b];d.clearChildren();this._removeChild(d)}this._spViews=undefined}}return this.clearChildrenByRange(0)},clearChildrenByRange:function(f,e){var b=this._children.length;if(b==0||f>=b||e<0){return true}if(f==undefined||f<0){f=0}if(e==undefined||e>=b){e=b-1}if(f>b){return false}for(var c=0,d=e-f;c<=d;c++){this._children[f].clearChildren();this.removeChildAt(f)}return true},clearFromParent:function(){this.clearChildren();this.removeFromParent()},removeFromParent:function(){if(!this._parent){return false}return this._parent.removeChild(this)},removeChild:function(f){if(!f){return f}var b=this._children.indexOf(f);if(b<0){for(var e in this._viewIDMap){if(this._viewIDMap[e]===f){this._removeChild(f);delete this._viewIDMap[e];return f}}if(this._spViews){for(var c=0,d=this._spViews.length;c<d;c++){if(f===this._spViews[c]){this._removeChild(f);delete this._spViews[c];return f}}}return null}else{return this.removeChildAt(this._children.indexOf(f))}},removeChildAt:function(b){var d=this._children.length;if(b<0||b>=d.length){return null}var c=this._children.splice(b,1);if(!c||!c.length){return null}c=c[0];this._removeChild(c);return c},_removeChild:function(b){b._parent=null;b._rendered=false;b._events=null;if(!b._element){return}if(b._element.parentNode){b._element.parentNode.removeChild(b._element)}else{}if(b.didUnload){b.didUnload()}if(b._baseViewDelegate&&b._baseViewDelegate.viewDidUnload){b._baseViewDelegate.viewDidUnload(b)}b.fire("didUnload")},setStyle:function(b,c){this._checkElement();if(this._isInteger(c)&&a.View.cssNumber[b]){c=c+"px"}this._element.style[b]=c;return this},getStyle:function(b){this._checkElement();return window.getComputedStyle(this._element).getPropertyValue(b)},getAttribute:function(b){this._checkElement();return this._element.getAttribute(b)},setAttribute:function(b,c){this._checkElement();this._element.setAttribute(b,c);return this},removeAttribute:function(b){this._checkElement();this._element.removeAttribute(b);return this},attr:function(c,b){if(b===undefined){console.error("attr function is Deprecated, use getAttribute instead");return this._element.getAttribute(c)}else{console.error("attr function is Deprecated, use setAttribute instead");this._element.setAttribute(c,b);return this}},addClass:function(b){this._checkElement();this._element.classList.add(b);return this},removeClass:function(b){return this._element.classList.remove(b)},hasClass:function(b){return this._element.classList.contains(b)},bindEvents:function(e){if(!e){return}this._checkElement();var g=this._element.querySelectorAll("*[data-ch-click]");for(var c=0,b=g.length;c<b;++c){var h=g[c];var f=a.CommonUtil.getDataSet(g[c],"chClick");var d=this._parseFn(f);if(!d){throw new Error("can't parse click event. "+f)}d.args.push(h);this._bindEventToFn(h,"click",d,e)}},_bindEventToFn:function(f,e,b,d){var c=d[b.name];if(typeof c!=="function"){throw new Error("can't find function "+b.name+" in baseViewDelegate.")}this._viewEvents.bind(f,e,function(){c.apply(d,b.args)})},_parseFn:function(t){t=a.CommonUtil.trim(t);var b=t.match(/^(\w+)([(]?)([^()]*)([)]?)$/);if(!b){return undefined}if(!b[1]||(b[2]&&!b[4])||(!b[2]&&b[4])){return undefined}var e=b[1];var k=a.CommonUtil.trim(b[3]);var r=[];var l=[function(i){var c=i.match(/^['"]{1}(.*)['"]{1}$/);if(!c){return}r.push(c[1]);return true},function(j){var c=parseFloat(j);if(!Number.isNaN(c)){r.push(c);return true}}];if(k){k=k.split(",");for(var q=0,f=k.length;q<f;q++){var d=a.CommonUtil.trim(k[q]);var g=false;for(var o=0,h=l.length;o<h;o++){var s=l[o];if(s(d)){g=true;break}}if(!g){throw new Error("can't parse parameter "+d)}}}return{name:e,args:r}},bind:function(c,d,b){this._checkElement();this._viewEvents.bind(this._element,c,d,b)},unbind:function(b,c){if(!this._element){return}this._viewEvents.unbind(this._element,b,c)},getViewStatus:function(){if(!this._rendered){return"unrendered"}if(!this._parent){return"uninitialized"}return"initialized"},hide:function(){this._checkElement();if(this.getStyle("display")==="none"){return}this.setStyle("display","none");this.fire("hide");if(this._baseViewDelegate&&this._baseViewDelegate.viewDidHide){this._baseViewDelegate.viewDidHide(this)}},visible:function(){var b=this.getStyle("display");return b!=="none"},show:function(){this._checkElement();if(this.getStyle("display")==="block"){return}this.setStyle("display",null);this.fire("show");if(this._baseViewDelegate&&this._baseViewDelegate.viewDidShow){this._baseViewDelegate.viewDidShow(this)}},toggle:function(){if(this.getStyle("display")==="block"){this.hide();return"hide"}else{this.show();return"show"}},html:function(b){this._checkElement();if(b===undefined){return this._element.innerHTML}else{this._element.innerHTML=b;return this}return this._element.innerHTML},getTagName:function(){this._checkElement();return this._element.tagName},_isInteger:function(b){if(b==undefined){return 0}return(parseInt(b,10).toString()===b.toString())?1:0},startAnimation:function(){var b={};var d=container._children.length;container.addSubView(view);view.render();var c=this;startCSSAnimation(container,tarView,{didAnimationEnd:function(){if(c._animating===false){return}if(container._children.length>1){var e=container.getChildAt(0);e.clearFromParent()}c.render();c._animating=false;finish&&finish()}})},animate:function(c,b,e,d){}})}).define(function(a){a.View.cssNumber={width:true,height:true,top:true,left:true,columnCount:true,fillOpacity:true,fontWeight:true,lineHeight:true,opacity:true,orphans:true,widows:true,zIndex:true,zoom:true};(function(d){var f=function(i,h){a.View.prototype["get"+h]=function(){return this.getStyle(i)};a.View.prototype["set"+h]=function(j){this.setStyle(i,j)}};for(var c=0,g=d.length;c<g;c++){var e=d[c];var b=e.charAt(0).toUpperCase()+e.slice(1);f(e,b)}})(["height","width","top","left"]);if(!a.CommonUtil.haveClassList){a.View.prototype.addClass=function(d){this._checkElement();var c=this.attr("class");var b=null;if(!c){b=d}else{var e=c.split(" ");e[e.length]=d;b=e.join(" ")}this.attr("class",b);return this};a.View.prototype.removeClass=function(c){this._checkElement();var b=this.attr("class");if(b){if(b.indexOf(c)<0){return this}var d=b.split(" ");var e=d.indexOf(c);if(e>=0){newName=d.splice(0,e).join(" ");if(d.length>1){newName+=" "+d.splice(1).join("")}this.attr("class",newName)}}return this};a.View.prototype.hasClass=function(c){var b=this.attr("class");if(!b){return false}else{return(" "+b+" ").indexOf(" "+c+" ")>-1}}}return undefined});Package("tupai.ui").use("tupai.ui.View").define("TableView",function(a){return a.View.extend({_tableViewDelegate:undefined,initialize:function(b){a.View.prototype.initialize.apply(this,arguments);this._container=this},setTableViewDelegate:function(b){this._tableViewDelegate=b},dequeueReusableCell:function(b){return null},setFilter:function(b){this.iterateChildren(function(c){if(b(c)){c.show()}else{c.hide()}})},loadTopNewData:function(){return this.reloadRowsFrom()},loadBottomNewData:function(b){var d=this._numberOfRows||0;if(b!==undefined){var c=this._tableViewDelegate.numberOfRows(this);d-=(b-(c-d))}return this.reloadRowsFrom(d)},setContainerId:function(c){var b=this.findViewById(c);if(!b){throw new Error("can't find view by "+c)}this._container=b},_addSubView:function(b){this._container.addSubView(b)},reloadData:function(){return this.reloadRowsFrom(0)},reload:function(){return this.reloadRowsFrom(0)},reloadRowsFrom:function(f){if(f==undefined||f<0){f=0}var e=f;if(this._hasHeader){e++}if(!this._container.clearChildrenByRange(e)){return}if(!this._tableViewDelegate){console.warn("table vie delegate not set. Please set it by tableview.setTableViewDelegate");return}if(this._tableViewDelegate.cellForRowAtTop){b=this._tableViewDelegate.cellForRowAtTop(this);if(b){if(!this._hasHeader){this._addSubView(b)}this._hasHeader=true}else{if(this._hasHeader){this.removeChildAt(0)}this._hasHeader=false}}var d=this._tableViewDelegate.numberOfRows(this);this._numberOfRows=d;if(f<d){for(var c=f;c<d;c++){var b=this._tableViewDelegate.cellForRowAtIndexPath({row:c},this);if(!b){throw new Error("you need return view by row "+c)}this._addSubView(b)}}if(this._tableViewDelegate.cellForRowAtBottom){b=this._tableViewDelegate.cellForRowAtBottom(this);b&&this._addSubView(b)}this.render()}})});Package("tupai.ui").use("tupai.ui.View").define("TemplateView",function(a){return a.View.extend({initialize:function(b){console.error("TemplateView is Deprecated, use View instead");a.View.prototype.initialize.apply(this,arguments)}})});Package("tupai.model.caches").use("tupai.util.MemCache").use("tupai.model.caches.QueueCacheDataSet").define("QueueCache",function(a){return Package.Class.extend({initialize:function(f,e,g){e=e||{};var b,j;if(e.memCache){var k=e.memCache;b=k.limit;j=k.overflowRemoveSize}this._storage=new a.MemCache(b,j);this._storage.setDelegate(this);this._attributes=e.attributes;if(e.localStorage){this._nativeStorage=window.localStorage;this._nativeStorageDefaultMeta={version:1}}else{if(e.sessionStorage){this._nativeStorage=window.sessionStorage;this._nativeStorageDefaultMeta={version:1}}}if(this._nativeStorage){this._nativeStorageKey="__tupai_"+f;var h=this._nativeStorage.getItem(this._nativeStorageKey);if(h){var i=JSON.parse(h);if(i.m&&i.d){this._storage.swapStorage(i.d);this._meta=i.m}else{console.warn("unknow native storage format!")}}}this._uniqField=e.uniqField;this._delegate=g;this._name=f},getCreated:function(){return this._meta&&this._meta.created},didMemCacheGC:function(){this._saveToNative();this._delegate&&this._delegate.didCacheGC&&this._delegate.didCacheGC(this._name,this)},getName:function(){return this._name},notifyDataSetChanged:function(b){this._saveToNative();this._delegate&&this._delegate.didCacheChanged&&this._delegate.didCacheChanged(this._name,this,b)},_saveToNative:function(){if(this._nativeStorage){var c=this._meta;if(!c){c=this._meta={};for(var b in this._nativeStorageDefaultMeta){c[b]=this._nativeStorageDefaultMeta[b]}}c.created=(Date.now?Date.now():(+new Date()));var e={m:c,d:this._storage.getStorage()};this._nativeStorage.setItem(this._nativeStorageKey,JSON.stringify(e))}},end:function(b){this.notifyDataSetChanged(b)},query:function(b){var c=new a.QueueCacheDataSet(this._storage,b);return c},getAttribute:function(b){return this._attributes&&this._attributes[b]},setAttribute:function(c,d){if(!this._attributes){this._attributes={}}var b=this._attributes[c];this._attributes[c]=d;return b},push:function(b){if(this._uniqField){b=this._removeDup(b)}if(b instanceof Array){this._storage.concat(b)}else{this._storage.push(b)}},unshift:function(b){if(this._uniqField){b=this._removeDup(b)}if(b instanceof Array){this._storage.concatFirst(b)}else{this._storage.unshift(b)}},_removeDup:function(h){var e={};var b=this._uniqField;if(h instanceof Array){var f=[];for(var d=0,j=h.length;d<j;d++){var g=h[d];var c=g[b];if(!e[c]){f.push(g)}e[c]=true}h=f}else{e[h[b]]=true}this._storage.filter(function(k){var i=k[b];return !(e[i])});return h},filter:function(d,b){var c=this.size();this._storage.filter(d);if(!b&&this.size()!=c){this._delegate.didCacheChanged(this._name,this)}},iterator:function(b){this._storage.iterator(b)},remove:function(b){return this._storage.remove(b)},removeByElement:function(b){return this._storage.remove(b)},clear:function(){this._storage.clear()},get:function(b){return this._storage.get(b)},size:function(){return this._storage.size()}})});Package("tupai.model").use("tupai.events.Events").use("tupai.util.HashUtil").use("tupai.net.HttpClient").use("tupai.net.JsonpClient").use("tupai.net.HttpRequest").define("ApiManager",function(a){return Package.Class.extend({initialize:function(c){this._events=new a.Events();if(!c){throw new Error("missing config")}var d=c.client;this._client=this._createClient(c.client);var b=c.responseDelegate;if(b){this._responseDelegate=this._createResponseDelegate(b)}if(c.defaultRequestClasszz){console.error("defaultRequestClasszz is Deprecated, use requestClasszz instead")}this._requestClass=this._createClass(c.defaultRequestClasszz||c.requestClasszz,a.HttpRequest);this._requestParameterMap=c.apiParameterMap||{}},_createClass:function(c,b){if(c){if(typeof(c)==="string"){return Package.Class.forName(c)}else{if(typeof(c)==="function"){return c}else{throw new Error("cannot create class "+c)}}}else{return b}},_createResponseDelegate:function(c){var b=this._createClass(c.classzz);if(b){return new b(c.config)}else{return undefined}},_createClient:function(d){var c=d&&d.type;var b;if(c){if(c==="jsonp"){b=a.JsonpClient}else{if(c==="default"||c==="http"){b=a.HttpClient}else{throw new Error("unknow type "+c)}}}else{b=this._createClass(d&&d.classzz,a.HttpClient)}return new b(d&&d.config)},getRequestParameter:function(b,e){var d=this._requestParameterMap[b];if(!d){throw new Error("cannot find request for "+b+":"+e)}var c=d[e];if(!c){throw new Error("cannot find request for "+b+":"+e)}return c},createRequest:function(d){var c=this.getRequestParameter(d.name,d.requestName);var b=new this._requestClass(c);b.addAll(d);b.setName(d.name);b.setRequestName(d.requestName);return b},executeRequest:function(c,g,e,f,b){var d=this;this._client.execute(e,{didHttpRequestSuccess:function(h,j){var i=true;if(d._responseDelegate&&d._responseDelegate.didHttpRequestSuccess){d._responseDelegate.didHttpRequestSuccess(c,g,h,j);if(d._responseDelegate.handleNotify){i=false}}if(i){d.notify(c,g,"didHttpRequestSuccess",h,j)}if(typeof(f)=="function"){f(c,g,h,j)}},didHttpRequestError:function(h,j){var i=true;if(d._responseDelegate&&d._responseDelegate.didHttpRequestError){d._responseDelegate.didHttpRequestError(c,g,h,j);if(d._responseDelegate.handleNotify){i=false}}if(i){d.notify(c,g,"didHttpRequestError",h,j)}if(typeof(b)=="function"){b(c,g,h,j)}}})},execute:function(f,i,e,c,h,b){var g;if(typeof(f)==="object"){a.HashUtil.only("ApiManager.execute ",f,["managerName","name","requestName","parameters","queryParameters","formDatas","attributes","success","error"]);g=f}else{console.error("this parameter is Deprecated in ApiManager.execute");g={name:f,requestName:i,parameters:e,queryParameters:c,formDatas:h,attributes:b}}var d=this.createRequest(g);this.executeRequest(g.name,g.requestName,d,g.success,g.error)},registerObserver:function(c,b,d){this._events.addEventListener(c,b,d)},unRegisterObserver:function(c,b){this._events.removeEventListener(c,b)},notify:function(f,i,d,c,g,b){var h={name:f,requestName:i,response:c,request:g,attributes:b};this._events.fireDelegate(f,d,h)}})});Package("tupai").use("tupai.events.Events").use("tupai.ui.View").use("tupai.TransitManager").use("tupai.PushStateTransitManager").define("Window",function(a){return a.View.extend({initialize:function(b){a.View.prototype.initialize.apply(this,[]);this._config=b||{};this._events=new a.Events();if(this._config.routes){if(b.disablePushState||!("state" in window.history)){this._transitManager=new a.TransitManager(this,b.routes)}else{this._transitManager=new a.PushStateTransitManager(this,b.routes,b.pushState)}this._transitManager.setDelegate(this)}else{if(this._config.rootViewController){this._rootViewControllerClasszz=this._config.rootViewController}}},getConfig:function(b){if(b==undefined){return this._config}return this._config[b]},back:function(e,b,c){if(!this._transitManager){return}this._transitManager.back.apply(this._transitManager,arguments);var d={targetUrl:e,options:b,transitOptions:c};this.fire("transit.did.back",d);this.fireDelegate("transit","didWindowBack",d)},backTo:function(b){if(!this._transitManager){return}this._transitManager.backTo.apply(this._transitManager,arguments);var c={index:b};this.fire("transit.did.backTo",c);this.fireDelegate("transit","didWindowBackTo",c)},transitWithHistory:function(c,b,d){if(!this._transitManager){return}this._transitManager.transitWithHistory.apply(this._transitManager,arguments);var e={url:c,options:b,transitOptions:d};this.fire("transit.did.transitWithHistory",e);this.fireDelegate("transit","didWindowTransitWithHistory",e)},getTitle:function(){if(!this._transitManager){return""}return this._transitManager.getTitle.apply(this._transitManager,arguments)},setTitle:function(){if(!this._transitManager){return""}return this._transitManager.setTitle.apply(this._transitManager,arguments)},getTransitHistories:function(){if(!this._transitManager){return}return this._transitManager.getHistories.apply(this._transitManager,arguments)},transit:function(c,b,d){if(!this._transitManager){return}this._transitManager.transit.apply(this._transitManager,arguments);var e={url:c,options:b,transitOptions:d};this.fire("transit.did.transit",e);this.fireDelegate("transit","didWindowTransit",e)},showRoot:function(d,c){var e={entry:true};if(this._transitManager){return this.transit(d,c,e)}else{if(!this._rootViewControllerClasszz){throw new Error("missing root view controller.")}}var b=new this._rootViewControllerClasszz(this);b.viewInit(c,"/root",e);this.transitController(b,"/root",c,e)},transitController:function(c,e,d,f){if(!c){throw new Error("can\t found controller.("+e+")")}else{var b=c.getContentView();if(!b){throw new Error("cannot get contentView from ViewController")}this._displayView(b,f);this._currentController=c;var g={controller:c,url:e,options:d,transitOptions:f};this.fire("transit.did.transitController",g);this.fireDelegate("transit","didWindowTransitController",g)}},getCurrentController:function(){return this._currentController},_displayView:function(b,d){this._startDisplayView=true;var e=this;var c=function(){if(e._finishDisplayQueue){var f=e._finishDisplayQueue;while((m=f.pop())){m()}}e.enableAction&&e.enableAction();e._startDisplayView=false};this.disableAction&&this.disableAction();if(d.animation!==false){this.clearChildren();this.addSubView(b);this.render();c()}},_displayViewWithAnimation:function(b,c){},doWhenFinishDisplay:function(b){if(this._startDisplayView){if(!this._finishDisplayQueue){this._finishDisplayQueue=[]}this._finishDisplayQueue.push(b)}else{b()}},_checkElement:function(){if(this._element){return}var c=this._config.winConfig;if(c){this._element=c.element}else{var b=document.querySelectorAll("*[data-ch-window]");if(!b||b.length<1){this._element=document.getElementsByTagName("body")[0]}else{this._element=b[0]}}},_onHTMLRender:function(){if(this._rendered){return false}this._rendered=true;return true},render:function(c){this._checkElement();var d=this._element;var b=this._onHTMLRender(d,c);this._onChildrenRender(c);if(b){this.didLoad&&this.didLoad()}},fire:function(){this._events.fire.apply(this._events,arguments)},fireDelegate:function(){this._events.fireDelegate.apply(this._events,arguments)},on:function(){this._events.on.apply(this._events,arguments)},once:function(){this._events.once.apply(this._events,arguments)},addEventListener:function(){this._events.addEventListener.apply(this._events,arguments)},removeEventListener:function(){this._events.removeEventListener.apply(this._events,arguments)},off:function(){this._events.off.apply(this._events,arguments)}})});Package("tupai.model").use("tupai.events.Events").use("tupai.model.caches.QueueCache").use("tupai.model.caches.HashCache").define("CacheManager",function(a){return Package.Class.extend({initialize:function(c){this._events=new a.Events();this._caches={};if(c){for(var b in c){var d=c[b];this.createCache(b,d)}}},removeCache:function(b){if(this._caches[b]){delete this._caches[b]}},createCache:function(c,g){var f;var d=g.type;if(typeof(d)==="string"){if(d=="queue"){f=a.QueueCache}else{if(d==="hash"){f=a.HashCache}else{throw new Error("unkown cache type. "+d)}}}else{var e=g.classzz;if(!e){f=a.QueueCache}else{if(typeof(e)==="string"){f=Package.Class.forName(e)}else{if(typeof(e)==="function"){f=e}else{throw new Error("cannot create cache class "+e)}}}}var b=new f(c,g.config,this);this._caches[c]=b;return b},didCacheGC:function(b){this.notifyGC(b)},didCacheChanged:function(d,b,c){this.notifyChanged(d,c)},getCache:function(c){var b=this._caches[c];return b},cacheIterator:function(d){var b=this._caches;for(var c in b){d(c,b[c])}},getCacheNames:function(){var c=[];for(var b in this._caches){c.push(b)}return c},getAttribute:function(b,c){return this.getCache(b).getAttribute(c)},iterator:function(b,c){return this.getCache(b).iterator(c)},get:function(b,c){return this.getCache(b).get(c)},size:function(b){return this.getCache(b).size()},registerObserver:function(c,b,d){this._events.addEventListener(c,b,d)},unRegisterObserver:function(c,b){this._events.removeEventListener(c,b)},notifyGC:function(b){var c={name:b};this._events.fireDelegate(b,"didCacheGC",c)},notifyChanged:function(c,b){var d={name:c,options:b};this._events.fireDelegate(c,"didCacheChanged",d)}})});Package("tupai").use("tupai.events.Events").use("tupai.model.CacheManager").use("tupai.model.ApiManager").use("tupai.util.CommonUtil").use("tupai.Window").define("Application",function(a){return Package.Class.extend({_window:undefined,_delegate:undefined,_events:undefined,DEFAULT_WIN_ID:"default",initialize:function(b,c){this._setupWindows(b,c);this._delegate=c;if(b){this._attributes=b.attributes;this.addApiManagers(b.apiManagers);this.addApiManager(b.apiManager);this.setupCacheManager(b.cacheManager)}this._events=new a.Events();a.Application.instance=this;this._delegate&&this._delegate.didApplicationLoad&&this._delegate.didApplicationLoad()},_setupWindows:function(e,h){this._windows={};var j;if(e&&e.windows){j=function(i){return e.windows[i]}}else{j=function(l){var i=e&&e.window;return i||{}}}var k;if(h){k=function(n,l){var i=j(n);i.winConfig={element:l,id:n};return h.createWindow(i,n)}}else{k=function(n,l){var i=j(n);i.winConfig={element:l,id:n};return new a.Window(i)}}var b=document.querySelectorAll("*[data-ch-window]");if(!b||b.length<1){var f=document.getElementsByTagName("body")[0];this._windows[this.DEFAULT_WIN_ID]=k(this.DEFAULT_WIN_ID,f)}else{for(var g=0,d=b.length;g<d;g++){var f=b[g];var c=a.CommonUtil.getDataSet(f,"chWindow")||this.DEFAULT_WIN_ID;this._windows[c]=k(c,f)}}},setupCacheManager:function(b){if(!b){return}if(this._cacheManager){throw new Error("CacheManager has already setup.")}this._cacheManager=new a.CacheManager(b)},addApiManager:function(c,b){if(!c){return}if(!this._apiManagers){this._apiManagers={}}b=b||"default";this._apiManagers[b]=new a.ApiManager(c)},addApiManagers:function(c){if(!c){return}for(var b in c){this.addApiManager(c[b],b)}},getCacheManager:function(){return this._cacheManager},getCache:function(b){return this._cacheManager.getCache(b)},getApiManager:function(b){b=b||"default";return this._apiManagers[b]},setAttribute:function(c,d){if(!this._attributes){this._attributes={}}var b=this._attributes[c];this._attributes[c]=d;return b},getAttribute:function(b){return this._attributes&&this._attributes[b]},fire:function(){this._events.fire.apply(this._events,arguments)},fireDelegate:function(){this._events.fireDelegate.apply(this._events,arguments)},on:function(){this._events.on.apply(this._events,arguments)},once:function(){this._events.once.apply(this._events,arguments)},addEventListener:function(){this._events.addEventListener.apply(this._events,arguments)},removeEventListener:function(){this._events.removeEventListener.apply(this._events,arguments)},off:function(){this._events.off.apply(this._events,arguments)},close:function(){this._delegate&&this._delegate.didApplicationUnload&&this._delegate.didApplicationUnload()},getWindow:function(b){return this._windows[b||this.DEFAULT_WIN_ID]},show:function(c,b,e){var d=this._windows[e||this.DEFAULT_WIN_ID];d&&d.showRoot(c,b)}})});Package("tupai").use("tupai.Application").define("ViewController",function(a){return Package.Class.extend({_view:undefined,_window:undefined,_app:undefined,initialize:function(b){if(!b){throw new Error("no window")}this._window=b;this._app=a.Application.instance},getWindow:function(){return this._window},getApplication:function(){return this._app},registerCacheObserver:function(c,b,d){b=b||this;if(!this._cacheObservers){this._cacheObservers=[]}this._cacheObservers.push({name:c,observer:b});return this._app.getCacheManager().registerObserver(c,b,d)},unRegisterCacheObserver:function(c,b){b=b||this;return this._app.getCacheManager().unRegisterObserver(c,b)},registerApiObserver:function(c,b,f,d){var e=this._app.getApiManager(d);if(!e){throw new Error("can't found apiManager by name "+d)}b=b||this;if(!this._apiObservers){this._apiObservers=[]}this._apiObservers.push({managerName:d,name:c,observer:b});return e.registerObserver(c,b,f)},unRegisterApiObserver:function(c,b,d){var e=this._app.getApiManager(d);if(!e){throw new Error("can't found apiManager by name "+d)}b=b||this;return e.unRegisterObserver(c,b)},unRegisterObservers:function(){var b,d;if(this._cacheObservers){for(b=0,d=this._cacheObservers.length;b<d;b++){var c=this._cacheObservers[b];this.unRegisterCacheObserver(c.name,c.observer)}}if(this._apiObservers){for(b=0,d=this._apiObservers.length;b<d;b++){var c=this._apiObservers[b];this.unRegisterApiObserver(c.name,c.observer,c.managerName)}}},executeApi:function(b){if(!b){throw new Error("missing required parameter.")}var c=b.managerName;this._app.getApiManager(c).execute(b)},getCache:function(b){return this._app.getCache(b)},getCacheManager:function(){return this._app.getCacheManager()},getApiManager:function(b){return this._app.getApiManager(b)},getContentView:function(){return this._view},setContentView:function(b){if(b){b.setDelegate(this)}this._view=b},getViewStatus:function(){if(!this._view){return null}return this._view.getViewStatus()},findViewById:function(){if(!this._view){return null}return this._view.findViewById.apply(this._view,arguments)},viewDidLoad:function(b){},viewDidUnload:function(b){this.unRegisterObservers()},viewInit:function(c,b,d){}})});