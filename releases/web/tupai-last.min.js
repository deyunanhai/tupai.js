(function(c){function a(r,t,s){for(var q in t){if(s||typeof r[q]==="undefined"){r[q]=t[q]}}return r}function b(q,s){var r=function(){this.initialize&&this.initialize.apply(this,arguments)};r.prototype=q||{};if(s){a(r,s)}return r}var j={};function h(u,r){var w=j;var q=u?u.split("."):[];for(var t=0,x=q.length;t<x;t++){var s=q[t];var v=w[s];if(!v){v=r||{};w[s]=v}w=v}return w}function n(s){var q=s;var u=q[q.length-1];var w=j;for(var t=0,x=q.length;t<x;t++){var r=q[t];var v=w[r];if(!v){return null}w=v}return w}var d={};var k="";var p=true;var o=true;function l(u,w){if(!w){return}var r=w.split(".");var x=r[r.length-1];var y=u._classProvider;if(y[x]){return}var t=n(r);if(!t){if(!u._waitQueue){u._waitQueue={}}u._waitQueue[w]=undefined;var v=d[w];if(v){v.push(u);return}else{d[w]=v=[];v.push(u)}if(!p){return}var z=document.createElement("script");z.type="text/javascript";z.async=true;if(window.ActiveXObject){z.onreadystatechange=function(){if(z.readyState=="complete"||z.readyState=="loaded"){g(w)}}}else{z.onload=function(){g(w)}}var q=k+w.split(".").join("/")+".js";if(!o){q+="?"+Date.now()}z.src=q;document.getElementsByTagName("head")[0].appendChild(z)}else{y[x]=t}}function e(v){var q=d[v];if(!q){return}for(var r=0,u=q.length;r<u;r++){var s=q[r];var t=s._waitQueue;if(!t){continue}delete t[v];l(s,v);s.checkAndRun()}delete d[v]}function g(r){var q=n(r.split("."));if(!q){return}e(r)}var f=b({initialize:function(q){q=q||"";this._packageObj=h(q);this._classProvider={};this._classObject=undefined;this._packageName=q;this._className=undefined;this._runQueue=[]},use:function(q){l(this,q);return this},checkAndRun:function(){if(this._waitQueue){for(var r in this._waitQueue){return false}delete this._waitQueue}while(true){var q=this._runQueue.shift();if(!q){break}q(this)}if(this._className){e(this._packageName+"."+this._className)}},define:function(r,q){this._runQueue.push(function(t){if(typeof r==="string"){var s=r;var v=q;var u=((typeof v!=="function")?v:v(t._classProvider));t._packageObj[s]=u;t._classProvider[s]=u;t._className=s;t._classObject=u}else{var v=r;if(!t._classObject){throw new Error("must define with name first.")}var u=((typeof v!=="function")?v:v.apply(t._classObject,[t._classProvider]));if(u){a(t._classObject,u,true)}}});this.checkAndRun();return this},run:function(q){this._runQueue.push(function(r){if(typeof q!=="function"){throw Error()}q(r._classProvider)});this.checkAndRun();return this}});var i=b({initialize:function(){}});i.forName=function(q){if(!q){throw new Error("cannot find package!"+q)}var r=n(q.split("."));if(!r){throw new Error("cannot find package!"+q)}return r};i.extend=function(r,s){var t=this;var q=b(r,s);a(q.prototype,t.prototype,false);q.prototype.SUPER=this.prototype;q.SUPER=this;q.extend=t.extend;return q};c.Package=function(q){return new f(q)};c.Package.setBaseUrl=function(q){k=q};c.Package.setAutoLoad=function(q){p=q};c.Package.setCacheEnabled=function(q){o=q};c.Package.Class=i;c.Package.classProvider=j})(window);Package("tupai.events").define("Events",function(a){return Package.Class.extend({initialize:function(b){this._events={}},fire:function(d,h){var c=this._events[d];if(c){var f=h||{};f.eventName=d;f.stop=false;for(var b=0,g=c.length;b<g;b++){if(!c[b]){continue}c[b](f);if(f.stop){break}}}},fireDelegate:function(b,f,j){var d=this._events[b];if(d){var g=j||{};g.targetName=b;g.eventName=f;g.stop=false;for(var c=0,h=d.length;c<h;c++){if(!d[c]){continue}if(d[c][f]){d[c][f](g);if(g.stop){break}}}}},addEventListener:function(c,d,e){var b=this._events[c];if(!b){this._events[c]=b=[]}else{if(b.indexOf(d)>=0){return false}}if(e){b.unshift(d)}else{b.push(d)}return true},removeEventListener:function(d,e){var c=this._events[d];if(!c){return}var b;if((b=c.indexOf(e))<0){return false}delete c[b];return true},removeAllEventListener:function(b){delete this._events[b]},clear:function(){this._events={}}})});Package("tupai.util").define("MemCache",function(a){return Package.Class.extend({_limit:undefined,_storage:undefined,initialize:function(b,c){this._limit=b||300;this._overflowRemoveSize=c||(this._limit/10);this._storage=[]},setDelegate:function(b){this._delegate=b},_cacheGC:function(d){var c,f;var e=this._storage;var b=this._overflowRemoveSize;if(d){for(c=0;c<b;c++){e.shift()}}else{for(c=0;c<b;c++){e.pop()}}this._delegate&&this._delegate.didMemCacheGC&&this._delegate.didMemCacheGC(this)},push:function(b){if(this._storage.length>=this._limit){this._cacheGC(true)}this._storage.push(b);return true},unshift:function(b){if(this._storage.length>=this._limit){this._cacheGC(false)}this._storage.unshift(b);return true},clear:function(){this._storage=[]},iterator:function(e){var d=this._storage;for(var b=0,c=d.length;b<c;b++){e(d[b])}},filter:function(f){var e=this._storage;var d=[];for(var b=0,c=e.length;b<c;b++){if(f(e[b],b)){d.push(e[b])}}this._storage=d},remove:function(c){var d=this._storage;var b=d.splice(c,1);if(!b||b.length<1){return undefined}return b[0]},removeByElement:function(c){var b=this._storage.indexOf(c);return this.remove(b)},concatFirst:function(b){if(this._storage.length+b.length>this._limit){this._cacheGC(false)}this._storage=b.concat(this._storage);return true},concat:function(b){if(this._storage.length+b.length>this._limit){this._cacheGC(true)}var e=this._storage;for(var c=0,d=b.length;c<d;c++){e.push(b[c])}return true},getStorage:function(){return this._storage},swapStorage:function(b){this._storage=b},get:function(b){return this._storage[b]},size:function(){return this._storage.length}})});Package("tupai.model").define("DataSet",function(a){return Package.Class.extend({initialize:function(b,c){},iterator:function(b){},get:function(b){},size:function(){}})});Package("tupai.model.caches").use("tupai.model.DataSet").define("HashCacheDataSet",function(a){return a.DataSet.extend({initialize:function(c,g,f){this.SUPER.initialize.apply(this,arguments);if(!c){throw new Error("missing required parameter. cache")}this._cache=c;this._size=g;if(f&&f.filter){var e={};var b=f.limit;var i=0;var h=f.filter;for(var d in c){if(h(c[d],d)){e[d]=c[d];i++;if(b&&(i)>=b){break}}}this._cache=e;this._size=i}},iterator:function(d){var c=this._cache;for(var b in c){d(c[b],b)}},get:function(c){var b=this._cache;return b[c]},size:function(){return this._size}})});Package("tupai.util").define("HashUtil",function(a){return{merge:function(b,d){if(!d){return b}b=b||{};for(var c in d){if(d.hasOwnProperty(c)){b[c]=d[c]}}return b},equals:function(c,b){if(c==b){return true}if(!c||!b){return false}for(key in c){if(c[key]!=b[key]){return false}}for(key in b){if(c[key]!=b[key]){return false}}return true},clone:function(d){var b={};if(d){for(var c in d){b[c]=d[c]}}return b},getValueByName:function(f,e){if(!e){return undefined}names=f.split(".");var g=e;var b;for(var c=0,h=names.length;c<h;c++){var b=names[c];g=g[b];if(!g){return g}}return g},only:function(f,e,d){if(!e){return false}var b=true;for(var c in e){if(d.indexOf(c)<0){b=false;console.error(c+" is unknown parameter in "+f)}}return b},swap:function(f,d){var e=arguments.length;if(!f||!d){return}var b={};for(var c in d){b[c]=f[c];f[c]=d[c]}return b},require:function(e,d){if(!e){throw new Error("missing required parameter.")}for(var c=0,f=d.length;c<f;c++){var b=d[c];if(e[b]==null){throw new Error("key :"+b+" required.")}}}}});Package("tupai.util").define("HttpUtil",function(j){function h(p,q,s){if(s==null){s=""}q=q.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+q+"=([^&#]*)");var o=r.exec(p);if(o==null){return s}else{return o[1]}}function l(o){return o.split("?")[0]}function c(o,p){return h(window.location.href,o,p)}function n(p,o){return(l(p)==l(o))}function a(){var p;try{p=new XMLHttpRequest()}catch(o){try{p=new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(o){try{p=new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(o){try{p=new ActiveXObject("Msxml2.XMLHTTP")}catch(o){try{p=new ActiveXObject("Microsoft.XMLHTTP")}catch(o){throw new Error("This browser does not support XMLHttpRequest.")}}}}}return p}function g(p){var q=[],o;for(o in p){q.push(encodeURIComponent(o)+"="+encodeURIComponent(p[o]))}return q.join("&")}function i(q){if(typeof q==="object"&&q!==null){var r;if(q instanceof Array){r=[];for(var p=0,s=q.length;p<s;p++){r.push(i(q[p]))}}else{r={};for(var o in q){r[o]=i(q[o])}}return r}else{return encodeURIComponent(q)}}function b(q,v,t,x){var w=a(),x=x||{},v=v||function(){},t=t||function(){},o=x.method||"GET",s=x.header||{},p=x.ctype||((o==="POST")?"application/x-www-form-urlencoded":""),r=x.data||"",u;w.onreadystatechange=function(){if(w.readyState===4){if((w.status>=200&&w.status<300)||w.status==0){v(w.responseText,w)}else{t(w)}}};if(typeof r==="object"){if(x.type==="json"){r=JSON.stringify(i(r))}else{r=g(r)}}w.open(o,q,true);if(p){w.setRequestHeader("Content-Type",p)}for(u in s){w.setRequestHeader(u,s[u])}w.send(r);return w}var d=false;var k=[];var f=function(){setTimeout(function(){d=true;var o;while((o=k.shift())){b.apply(this,o.param)}},10)};if(window.addEventListener){window.addEventListener("load",f,false)}else{window.attachEvent("onload",f)}function e(o){if(!d){k.push({param:o})}else{b.apply(this,o)}}return{encode:g,ajax:function(q,r,p,o){e([q,r,p,o])}}});Package("tupai.net").define("JsonpClient",function(a){return Package.Class.extend({initialize:function(b){this._autoIndex=true;if(b){if(b.hasOwnProperty("autoIndex")){this._autoIndex=b.autoIndex}}if(this._autoIndex){this._index=0}},_setupCallback:function(d,c,e){var b=this;window[d]=function(g){if(b._autoIndex){delete window[d]}var f={header:{},status:200,statusText:"OK",responseText:JSON.stringify(g),response:g};e&&e.didHttpRequestSuccess&&e.didHttpRequestSuccess(f,c)}},_setupScriptTag:function(b){var c=document.createElement("script");c.type="text/javascript";c.async=true;c.src=b;document.getElementsByTagName("head")[0].appendChild(c)},execute:function(c,e){if(!c){throw new Error("missing required parameter.")}var d="__tupai_jsonpCallbck";if(this._autoIndex){this._index++;d+=this._index}var b=c.getUrl();var f=c.getQueryString();if(b.indexOf("?")>0){b+="&"}else{b+="?"}b+="callback="+d;if(f){b+="&"+f}this._setupCallback(d,c,e);this._setupScriptTag(b)}})});Package("tupai.net").use("tupai.util.HashUtil").define("HttpRequest",function(a){return Package.Class.extend({initialize:function(b){a.HashUtil.require(b,["url"]);this._url=b.url;this._headers=b.headers||{};this._type=b.type||"json";this._method=b.method;this._attributes=b.attributes;this._noFormData=!!(!this._method||this._method.match(/get/i));this._parameters=b.parameters;this._queryParameters=b.queryParameters;this._formData=b.formData},addAll:function(b){this.addParameters(b.parameters);this.addQueryParameters(b.queryParameters);this.addFormDatas(b.formDatas);this.addAttributes(b.attributes);this.addHeaders(b.headers)},addHeaders:function(b){this._headers=a.HashUtil.merge(this._headers,b)},addAttributes:function(b){this._attributes=a.HashUtil.merge(this._attributes,b)},addParameters:function(b){this._parameters=a.HashUtil.merge(this._parameters,b)},addQueryParameters:function(b){this._queryParameters=a.HashUtil.merge(this._queryParameters,b)},addFormDatas:function(b){this._formData=a.HashUtil.merge(this._formData,b)},getUrl:function(){return this._url},getType:function(){return this._type},getHeaders:function(){return this._headers},getQueryData:function(){if(this._noFormData&&this._parameters){return a.HashUtil.merge(this._parameters,this._queryParameters)}else{return this._queryParameters}},getQueryString:function(){var d="";var b=this.getQueryData();if(b){for(var c in b){d+=c+"="+encodeURIComponent(b[c])+"&"}}if(d.length>1){return d.substring(0,d.length-1)}else{return null}},getAttributes:function(){return this._attributes},getAttribute:function(b){if(!this._attributes){return undefined}else{return this._attributes[b]}},getParameters:function(){return this._parameters},getParameter:function(b){if(!this._parameters){return undefined}else{return this._parameters[b]}},getData:function(){if(!this._noFormData&&this._parameters){return a.HashUtil.merge(this._parameters,this._formData)}else{return this._formData}},setRequestName:function(b){this._requestName=b},getRequestName:function(){return this._requestName},getName:function(){return this._name},setName:function(b){this._name=b},getName:function(){return this._name},getMethod:function(){return this._method}})});Package("tupai.util").define("CommonUtil",function(e){var h=document.createElement("div");var c;if(!h.dataset){var d=function(i){return i.replace(/([A-Z])/g,function(j){return"-"+j.toLowerCase()})};c=function(o,l){var j="data-";var k=o.attributes;var n=j+d(l);var i=k[n];return i&&i.value}}else{c=function(j,i){return j.dataset[i]}}var a=!!h.classList;var g=function(){var j=Array.prototype.slice.call(arguments);var k=j.shift(),i=j.shift();return function(){return k.apply(i,j.concat(Array.prototype.slice.call(arguments)))}};var f=function(i){if(!i){return false}return !!i.match(/^(https?|ftp)(:\/\/[-_.!~*\'()a-zA-Z0-9;\/?:\@&=+\$,%#]+)$/)};var b=function(i){if(!i){return false}return !!i.match(/^(https?)(:\/\/[-_.!~*\'()a-zA-Z0-9;\/?:\@&=+\$,%#]+)$/)};return{bind:g,isValidUrl:f,isValidHttpUrl:b,haveClassList:a,getDataSet:c}});Package("tupai").use("tupai.util.HashUtil").define("TransitManager",function(a){return Package.Class.extend({_delegate:undefined,initialize:function(c,b){var d,e;if(!b){throw new Error("missing transit_rules.")}this._history=[];this._window=c;this._controllerRefs={};for(d in b){var g=d.replace(/\*/g,"\\w*")+"$";var f=d.split("/");this._controllerRefs[g]={classzz:b[d]}}},setDelegate:function(b){this._delegate=b},_getController:function(d){var c,e;for(c in this._controllerRefs){if(d.match(c)){e=this._controllerRefs[c];if(!e.instance){var f=e.classzz;if(typeof(f)==="string"){var b=Package.Class.forName(f);e.instance=new b(this._window)}else{if(typeof(f)==="function"){e.instance=new e.classzz(this._window)}else{throw new Error("cannot create view controller."+f)}}}return e.instance}}throw"could not find "+d},size:function(){return this._history.length},lastIndexOf:function(d){if(!d){return -1}var c=this._history;for(var b=c.length-1;b>=0;b--){if(c[b].url==d){return b}}return -1},indexOf:function(e){if(!e){return -1}var c=this._history;for(var b=0,d=c.length;b<d;b++){if(c[b].url==e){return b}}return -1},_removeUntil:function(c){if(!c){return}var b;do{b=this._history.pop();if(!b){break}else{if(b.url==c){break}}}while(1);return b},back:function(h,e){var f;if(h){f=this._removeUntil(h);if(!f){f={url:h}}}else{f=this._history.pop();if(!f){return}}var d=f.url;var c=f.options;var g=this._current;e=e||{};e.transitType=2;var b=this._transit(d,c,e);this._current=f;return b},transitWithHistory:function(c,b,d){if(!this._current){throw new Error("can't transit with history.")}d=d||{};d.transitType=1;var e=this._current;if(this._transit(c,b,d)){this._history.push(e);return true}else{return false}},_currentRoute:undefined,_current:undefined,_computeTransitRoute:function(d){if(!d||d.length<1){return null}var c=d.replace(/(^\s+)|((\/|\s)+$)/g,"").split("/");if(c.length<2){return null}var b=this._currentRoute;this._currentRoute=c;if(!b){return{root:c[0],path:c.slice(1)}}var f=b.length>c.length?c.length:b.length;if(f==0){return null}var e=1;for(;e<f;e++){if(b[e]!=c[e]){break}}if(e==f&&b.length==c.length){return{root:c.slice(0,c.length-1).join("/"),path:c.slice(c.length-1)}}return{root:c.slice(0,e).join("/"),path:c.slice(e)}},transit:function(c,b,d){return this._transit(c,b,d)},_transit:function(c,o,k){if(this._current&&this._current.url==c&&a.HashUtil.equals(this._current.options,o)){return false}var l=this._computeTransitRoute(c);if(l==null){return false}var g=(l.root?this._getController(l.root):this._window);var d=l.root;k=k||{};for(var f=0,e=l.path.length;f<e;f++){var b=l.path[f];var j=d+"/"+b;var h=this._getController(j);if(h.viewInit){h.viewInit(o,c,b)}if(!g.transitController){throw new Error("root controller must have transitController delegate function. "+c)}g.transitController(h,j,o,k);g=h;d=j}this._current={url:c,options:o};return true}})});Package("tupai.ui").use("tupai.util.CommonUtil").use("tupai.util.HashUtil").define("TemplateEngine",function(d){var a=function(n,l){var k=n.querySelectorAll("*[data-ch-name]");for(var h=0,f=k.length;h<f;++h){var o=k[h];var g=d.CommonUtil.getDataSet(k[h],"chName");var j=d.HashUtil.getValueByName(g,l);e(o,j)}var g=d.CommonUtil.getDataSet(n,"chName");if(g){var j=d.HashUtil.getValueByName(g,l);e(n,j)}};var c=function(g,h,j){if(g){a(g,j);return g}else{if(h){var k="div";if(h.match(/^<(tr|th)>/)){k="tbody"}else{if(h.match(/^<(tbody|thead)>/)){k="table"}}var f=document.createElement(k);f.innerHTML=h;var i=f.children[0];a(i,j);return i}else{return document.createElement("div")}}};var e=function(h,g){if(h.length){var f=(g instanceof Array)?g:[g];Array.prototype.forEach.call(h,function(i){if(f.indexOf(i.value)!=-1){i.selected=true}else{i.selected=false}})}else{if(h.value!==undefined){if(/radio|checkbox/.test(h.type)){h.checked=g}else{h.value=g}}else{if(h.src!==undefined){h.src=g}else{if(g===undefined){h.innerHTML=""}else{h.innerHTML=g}}}}};var b=function(g){if(!g){return null}if(g.length){if(g.getAttribute("multiple")){var f=[];Array.prototype.forEach.call(g,function(h){if(h.selected){f.push(h.value)}});return f}else{return g.value}}else{if(g.value!==undefined){if(/radio|checkbox/.test(g.type)){return g.checked}else{return g.value}}else{if(g.src!==undefined){return g.src}else{return g.innerHTML}}}return null};return{createElement:c,setValue:e,getValue:b}});Package("tupai.ui").define("ViewEvents",function(b){var c=function(f,e,g,d){if(!f||!e||!g){throw new Error("missing required parameters")}return f.addEventListener(e,g,d)};var a=function(e,d,f){if(!e||!d||!f){throw new Error("missing required parameters")}return e.removeEventListener(d,f)};return{bind:c,unbind:a}});Package("tupai.animation").use("tupai.util.HashUtil").define("TransitAnimation",function(a){return Package.Class.extend({initialize:function(b){this._options=b},startCSSAnimation:function(c,d,g){if(this._animating){return}this._animating=true;var e={};this.setupCSSAnimation(c,d,e);var i=function(){f()};c._element.addEventListener("webkitTransitionEnd",i,false);var b=setTimeout(f,this.getCleanupTimeOut());var h=this;function f(j){clearTimeout(b);c._element.removeEventListener("webkitTransitionEnd",i,false);h.cleanupCSSAnimation(c,d,e);g&&g.didAnimationEnd&&g.didAnimationEnd(h)}},cleanupCSSAnimation:function(b,c,e){var d=e.currentStyle;b.css({"-webkit-transition-duration":null,"-webkit-transition-property":null,"-webkit-transform":null});c.css({position:d.position||null,"overflow-y":d["overflow-y"]||null,left:d.left,top:d.top})},setupCSSAnimation:function(b,c,d){d.currentStyle={};d.currentStyle["overflow-y"]=c.css("overflow-y");d.currentStyle.top=c.css("top")||"0px";d.currentStyle.left=c.css("left")||"0px";d.currentStyle.position=c.css("position");c.css({position:"absolute",top:"0px",left:direction==="right2left"?(1*window.innerWidth)+"px":(-1*window.innerWidth)+"px","overflow-y":"hidden"});b.css({"-webkit-transition-property":"-webkit-transform","-webkit-transition-duration":300,"-webkit-transform":"translate3d("+(direction==="right2left"?(-1*window.innerWidth)+"px":window.innerWidth+"px")+", 0, 0)"})},getCleanupTimeOut:function(){return 500}})});Package("tupai.animation").use("tupai.util.HashUtil").define("Transition",function(a){return Package.Class.extend({initialize:function(b){this._options=b},getTransformation:function(){return{alpha:{},matrix:{}}},startCSSAnimation:function(c,e){this.setupCSSAnimation(c);var g=function(){d()};this._element.addEventListener("webkitTransitionEnd",g,false);var b=setTimeout(d,this.getCleanupTimeOut());var f=this;function d(h){clearTimeout(b);c._element.removeEventListener("webkitTransitionEnd",g,false);f.cleanupCSSAnimation(c);e&&e.didAnimationEnd&&e.didAnimationEnd(f)}},cleanupCSSAnimation:function(b){b.css({"-webkit-transition-duration":null,"-webkit-transition-property":null,"-webkit-transform":null});if(b._children.length>1){var c=b.getChildAt(0);c.clearFromParent()}},setupCSSAnimation:function(b){b.css({"-webkit-transition-property":"-webkit-transform","-webkit-transition-duration":300,"-webkit-transform":"translate3d("+(direction==="right2left"?(-1*window.innerWidth)+"px":window.innerWidth+"px")+", 0, 0)"})},getCleanupTimeOut:function(){return 500}})});Package("tupai.ui").use("tupai.util.HttpUtil").define("Templates",function(a){return Package.Class.extend({initialize:function(b){if(!b){throw new Error("missing required parameters.")}if(b.html){this._parseHtml(b.html)}else{if(b.url){var d=this;this._loading=true;a.HttpUtil.ajax(b.url,function(e){try{d._parseHtml(e)}finally{d._loading=false}},function(e){d._loading=false;b.error&&b.error(e)})}else{if(b.element){this._parseHtml(b.element.outerHTML)}else{if(b.elementId){var c=document.getElementById(b.elementId);if(c){this._parseHtml(c.outerHTML)}else{throw new Error("cannot find ["+b.elementId+"] to create Templates")}}}}}},_parseHtml:function(k){var l=document.createElement("div");l.innerHTML=k;var b=l.querySelectorAll("*[data-ch-template]");var n={};for(var e=0,j=b.length;e<j;++e){var f=b[e];var d=f.getAttribute("data-ch-template");if(!d){continue}f.removeAttribute("data-ch-template");var h=true;var c=f.getAttribute("data-ch-include-sub-templates");if(c){f.removeAttribute("data-ch-include-sub-templates");if(c==="true"){h=false}}if(h){f=f.cloneNode(true);this._removeSubTemplates(f)}var g=f.outerHTML;n[d]=g}this._templates=n;this._onReady()},_removeSubTemplates:function(g){var d=g.getElementsByTagName("*");var c=[];for(var f=0,j=d.length;f<j;f++){var b=d[f];if(!b){continue}var e=b.getAttribute("data-ch-template");if(!e){continue}c.push(b)}for(var f=0,j=c.length;f<j;f++){var h=c[f];h.parentNode.removeChild(h)}},_onReady:function(){this._ready=true;if(this._templates&&this._waitingQueue){while(true){var b=this._waitingQueue.shift();if(!b){break}b.callback&&b.callback(this._templates[b.id])}}},get:function(d,c){if(this._ready){var b=this._templates[d];c&&c(b);return b}else{if(!this._waitingQueue){this._waitingQueue=[]}this._waitingQueue.push({id:d,callback:c});return undefined}}})}).define(function(a){return({register:function(c,b){if(!a.Templates.instances){a.Templates.instances={}}a.Templates.instances[c]=new a.Templates(b)},getInstance:function(b){if(!a.Templates.instances){return undefined}else{return a.Templates.instances[b]}},getTemplate:function(c,d,e){var b=a.Templates.getInstance(c);if(!b){return undefined}return b.get(d,e)}})});Package("tupai.util").define("LinkedList",function(a){return Package.Class.extend({_root:undefined,_last:undefined,initialize:function(){this._size=0},_add:function(d,c,b){if(!this._last){this._root=d;this._last=c}else{if(b){c.next=this._root;this._root.prev=c;this._root=d}else{this._last.next=d;d.prev=this._last;this._last=c}}},push:function(c){var b={data:c,next:undefined,prev:undefined};this._add(b,b,false);this._size++},unshift:function(c){var b={data:c,next:undefined,prev:undefined};this._add(b,b,true);this._size++},clear:function(){this._root=undefined;this._last=undefined;this._size=0},iterator:function(d){var b=this._root;while(b){d(b.data);b=b.next}},_findByData:function(b){var c=this._root;while(c){if(b===c.data){return c}c=c.next}},_findByIndex:function(b){if(b<0||b>=this._size){return undefined}var c=this._root;while(c){if(b==0){return c}c=c.next;b--}},_remove:function(c,b){if(c.prev){if(b.next){c.prev.next=c.next;b.next.prev=b.prev}else{this._last=c.prev;this._last.next=undefined}}else{if(b.next){this._root=b.next;this._root.prev=undefined}else{this._root=this._last=undefined}}},removeByElement:function(c){var b=this._findByData(c);if(!b){return undefined}this._remove(b,b);this._size--;return c},removeByIndex:function(b){var c=this._findByIndex(b);if(!c){return undefined}this._remove(c,c);this._size--;return c.data},pop:function(){return this.removeLast()},shift:function(){return this.removeFirst()},removeFirst:function(){if(!this._root){return}var b=this._root.data;this._root=this._root.next;if(!this._root){this._last=undefined}else{this._root.prev=undefined}this._size--;return b},removeLast:function(){if(!this._last){return}var b=this._last.data;this._last=this._last.prev;if(!this._last){this._root=undefined}else{this._last.next=undefined}this._size--;return b},filter:function(f){var d=this._root;var e,c,b=0;while(d){if(!f(d.data,b)){if(!e){e=d}b++}else{if(e){this._remove(e,d.prev);this._size-=b;e=undefined;b=0}}c=d;d=d.next}if(e){this._remove(e,c);this._size-=b}},_createNode:function(b){var f,d,h;var g=b.length;for(var e=0;e<g;e++){h={data:b[e],next:undefined,prev:undefined};if(!d){f=d=h}else{d.next=h;h.prev=d;d=h}}if(f&&d){return{root:f,last:d,count:g}}else{return undefined}},concatFirst:function(b){var c=this._createNode(b);if(c){this._add(c.root,c.last,true);this._size+=c.count}},concat:function(b){var c=this._createNode(b);if(c){this._add(c.root,c.last,false);this._size+=c.count}},get:function(b){if(b<0||b>=this._size){return undefined}var c=this._findByIndex(b);return c?c.data:undefined},size:function(){return this._size}})});Package("tupai.util").define("UserAgent",function(i){var n=false,b,h,f,c,g,e,j,k,a,d;function l(){if(n){return}n=true;var q=navigator.userAgent;var p=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))/.exec(q);j=/\b(iPhone|iP[ao]d)/.exec(q);if(j){var o=q.match(/OS ([_\d\.]+)/);if(o&&o.length>1){j=parseFloat(o[1].split("_").join("."))}else{j=1}}k=/\b(iP[ao]d)/.exec(q);e=/Android (\d+(?:\.\d+)+)(-\w+)?;/i.exec(q);a=/Mobile/i.exec(q);e=e&&parseFloat(e[1]);if(e){d=/Android (\d+(?:\.\d+)+)(-\w+)?; (\w{2,3})\-(\w{2,3});\s([^\/]+)\sBuild/i.exec(q);if(d){d=d[5]}}if(p){b=p[1]?parseFloat(p[1]):NaN;if(b&&document.documentMode){b=document.documentMode}h=p[2]?parseFloat(p[2]):NaN;f=p[3]?parseFloat(p[3]):NaN;c=p[4]?parseFloat(p[4]):NaN;if(c){p=/(?:Chrome\/(\d+\.\d+))/.exec(q);g=p&&p[1]?parseFloat(p[1]):NaN}else{g=NaN}}else{b=h=f=g=c=NaN}}return{ie:function(){return l()||b},firefox:function(){return l()||h},opera:function(){return l()||f},safari:function(){return l()||c},chrome:function(){return l()||g},iphone:function(){return l()||j},mobile:function(){return l()||(j||k||e||a)},android:function(){return l()||e},device:function(){return l()||d},ipad:function(){return l()||k}}});Package("tupai.model.caches").use("tupai.model.DataSet").define("QueueCacheDataSet",function(a){return a.DataSet.extend({initialize:function(c,e){this.SUPER.initialize.apply(this,arguments);if(!c){throw new Error("missing required parameter. cache")}this._cache=c;if(e&&e.filter){var d=[];var b=e.limit;var h=0;var g=e.filter;for(var f=0,j=c.size();f<j;f++){if(g(c.get(f),f)){d.push(c.get(f));h++;if(b&&(h)>=b){break}}}this._newCache=d}},iterator:function(e){if(this._newCache){var d=this._newCache;for(var b=0,c=d.length;b<c;b++){e(d[b])}}else{this._cache.iterator.apply(this._cache,arguments)}},get:function(c){if(this._newCache){var b=this._newCache;return b[c]}else{return this._cache.get.apply(this._cache,arguments)}},size:function(){if(this._newCache){return this._newCache.length}else{return this._cache.size.apply(this._cache,arguments)}}})});Package("tupai.model.caches").use("tupai.model.caches.HashCacheDataSet").define("HashCache",function(a){return Package.Class.extend({_storage:null,initialize:function(d,b,e){b=b||{};this._idField=b.idField||"id";this._unique=b.unique;this._storage={};this._attributes=b.attributes;this._size=0;if(b.memCache){var g=b.memCache;this._limit=g.limit;this._overflowRemoveSize=g.overflowRemoveSize;if(!this._overflowRemoveSize){this._overflowRemoveSize=this._limit/10}}if(b.localStorage){this._nativeStorage=window.localStorage}else{if(b.sessionStorage){this._nativeStorage=window.sessionStorage}}if(this._nativeStorage){this._nativeStorageKey="__tupai_"+d;var f=this._nativeStorage[this._nativeStorageKey];if(f){this._storage=JSON.parse(f)}for(var d in this._storage){this._size++}}this._delegate=e;this._name=d},notifyDataSetChanged:function(b){this._saveToNative();this._delegate&&this._delegate.didCacheChanged&&this._delegate.didCacheChanged(this._name,this,b)},end:function(b){this.notifyDataSetChanged(b)},getAttribute:function(b){return this._attributes&&this._attributes[b]},query:function(b){var c=new a.HashCacheDataSet(this._storage,this._size,b);return c},_saveToNative:function(){if(this._nativeStorage){this._nativeStorage[this._nativeStorageKey]=JSON.stringify(this._storage)}},_cacheGC:function(){var b=this._overflowRemoveSize||100;for(var d=0;d<b;d++){L1:while(1){for(var c in this._storage){if(parseInt(Math.random()*3)==0){delete this._storage[c];this._size--;break L1}}}}this._saveToNative();this._delegate&&this._delegate.didCacheGC&&this._delegate.didCacheGC(this._name,this)},getName:function(){return this._name},getId:function(b){return b[this._idField]},_push:function(b){var c=this.getId(b);if(c==undefined){throw new Error("can't get "+this._idField+" from data.")}if(!this._storage.hasOwnProperty(c)){if(this._limit&&this._size>=this._limit){this._cacheGC()}this._size++}else{if(this._unique){throw new Error("duplicate key. "+c)}}this._storage[c]=b},push:function(c){if(c instanceof Array){for(var b=0,d=c.length;b<d;b++){this._push(c[b])}}else{this._push(c)}},filter:function(e,b){var d=false;var c;for(c in this._storage){if(!e(this._storage[c],c)){d=true;delete this._storage[c];this._size--}}if(!b&&d){this.notifyDataSetChanged({action:"filter"})}},unshift:function(b){this.push(b)},iterator:function(c){for(var b in this._storage){c(this._storage[b],b)}},remove:function(c){var b=this._storage[c];if(this._storage.hasOwnProperty(c)){delete this._storage[c];this._size--}return b},removeByElement:function(b){if(!b){return undefined}var c=this.getId(b);if(this._storage[c]===b){return this.remove(c)}return undefined},clear:function(){this._storage={};this._size=0},get:function(b){return this._storage[b]},size:function(){return this._size}})});Package("tupai.net").use("tupai.util.HttpUtil").define("HttpClient",function(a){return Package.Class.extend({initialize:function(b){if(b){this._defaultRequestHeaders=b.defaultRequestHeaders;this._fixAjaxCache=!!b.fixAjaxCache}if(!this._defaultRequestHeaders){this._defaultRequestHeaders={Accept:"application/json",Pragma:"no-cache","Cache-Control":"no-cache","If-Modified-Since":"Thu, 01 Jun 1970 00:00:00 GMT"}}},_mergeDefault:function(b,d){d=d||{};if(b){for(var c in b){d[c]=b[c]}}return d},_getResponseFromXhr:function(c,b){return{header:c.getAllResponseHeaders(),status:c.status,statusText:c.statusText,responseText:b}},_execute:function(f,i){var c=f.getUrl();var b=f.getQueryString();if(b){if(c.indexOf("?")>0){c+="&"}else{c+="?"}c+=b}var k=this._mergeDefault(this._defaultRequestHeaders,f.getHeaders());var g=f.getMethod();var e=f.getData();var h=f.getType();if(this._fixAjaxCache&&(!g||g.toLowerCase()==="get")){var d="__t="+(Date.now?Date.now():(+new Date()));if(c.indexOf("?")>0){c+="&"}else{c+="?"}c+=d}var j=this;a.HttpUtil.ajax(c,function(n,o){var l=j._getResponseFromXhr(o,n);i&&i.didHttpRequestSuccess&&i.didHttpRequestSuccess(l,f)},function(n){var l=j._getResponseFromXhr(n);i&&i.didHttpRequestError&&i.didHttpRequestError(l,f)},{method:g,data:e,type:h,header:k})},execute:function(b,c){if(!b){throw new Error("missing required parameter.")}this._execute(b,c)}})});Package("tupai.ui").use("tupai.util.CommonUtil").use("tupai.util.HashUtil").use("tupai.events.Events").use("tupai.ui.TemplateEngine").use("tupai.ui.ViewEvents").define("View",function(a){return Package.Class.extend({_children:undefined,_rendered:undefined,_element:undefined,_baseViewDelete:undefined,_events:undefined,initialize:function(b){this._children=[];this._events=undefined;this._didLoadFlg=false;this._templateEngine=a.TemplateEngine;this._viewEvents=a.ViewEvents;if(b){this._template=b.template;this._templateParameters=b.templateParameters}},fire:function(b,d){if(!this._events){return}var c=d||{};c.target=this;c.stopParent=false;this._events.fire(b,c);if(!c.stopParent&&this._parent){this._parent.fire(name,c)}},addEventListener:function(b,c,d){if(!this._events){this._events=new a.Events()}this._events.addEventListener(b,c,d)},removeEventListener:function(b,c){if(!this._events){return}this._events.removeEventListener(b,c)},setDelegate:function(b){this._baseViewDelete=b},markNeedRender:function(){for(var b=0,d=this._children.length;b<d;b++){var c=this._children[b];c.markNeedRender()}this._rendered=false},iterateChildren:function(e){for(var b=0,d=this._children.length;b<d;b++){var c=this._children[b];e(c)}},render:function(b){if(!this._rendered){if(!this._parent){throw new Error("no parent.")}this._parent.render(b)}this._onChildrenRender(b)},_onHTMLRender:function(b,c){if(this._rendered){return false}var d=null;this._checkElement();if(this.willRender){this.willRender()}b.appendChild(this._element);this._rendered=true;if(this.didRender){this.didRender()}if(this._baseViewDelete&&this._baseViewDelete.viewDidRender){this._baseViewDelete.viewDidRender(this)}this.fire("didRender");return true},_onChildrenRender:function(d){var b=this._getContainerNode();var c=function(j){var i=j._onHTMLRender(b,d);j._onChildrenRender(d);if(i){if(j.didLoad){j.didLoad()}if(j._baseViewDelete&&j._baseViewDelete.viewDidLoad){j._baseViewDelete.viewDidLoad(j)}j.fire("didLoad");j._didLoadFlg=true}};for(var e=0,h=this._children.length;e<h;e++){var g=this._children[e];c(g)}if(this._viewIDMap){for(var f in this._viewIDMap){var g=this._viewIDMap[f];c(g)}}},_getContainerNode:function(){return this._element},getTemplate:function(){if(typeof this._template==="function"){return this._template()}else{return this._template}},getTemplateParameters:function(){if(typeof this._templateParameters==="function"){return this._templateParameters()}else{return this._templateParameters}},_createElementsIDMap:function(){if(this._elementsIDMap){return}var g={};this._elementsIDMap=g;var d=this._element.querySelectorAll("*[data-ch-id]");for(var c=0,b=d.length;c<b;++c){var f=d[c];var e=a.CommonUtil.getDataSet(d[c],"chId");g[e]=f}},_checkElement:function(){if(this._element){return}var b=this.getTemplate();var c=this.getTemplateParameters();this._element=this._templateEngine.createElement(undefined,b,c);if(!this._element){throw new Error("cannot create element")}this._createElementsIDMap()},setTemplateParameters:function(c){this._templateParameters=c;if(this._element){var b=this.getTemplate();var d=this.getTemplateParameters();this._element=this._templateEngine.createElement(this._element,b,d)}},setData:function(b){this.setTemplateParameters(b)},getData:function(){return this.getTemplateParameters()},setValue:function(b){this._checkElement();return this._templateEngine.setValue(this._element,b)},getValue:function(){this._checkElement();return this._templateEngine.getValue(this._element)},addSubView:function(b){this._children.push(b);b._parent=this;if(typeof b.onAppendedToParent==="function"){b.onAppendedToParent()}},getChildAt:function(b){if(b<0||b>=this._children.length){return null}else{return this._children[b]}},findViewById:function(d){this._checkElement();if(!this._viewIDMap){this._viewIDMap={}}var b=this._viewIDMap[d];if(b===undefined){var c=this._elementsIDMap[d];if(!c){return undefined}b=this._viewIDMap[d]=new a.View();b._element=c;b._parent=this;b._rendered=true}return b},_onRemoveChildren:function(){for(var b=0,e=this._children.length;b<e;b++){var d=this._children[b];this._removeChild(d)}},_removeChild:function(b){b._onRemoveChildren();b._parent=null;b._rendered=false;b._events=null;b._element.parentNode.removeChild(b._element);if(b.didUnload){b.didUnload()}if(b._baseViewDelete&&b._baseViewDelete.viewDidUnload){b._baseViewDelete.viewDidUnload(b)}b.fire("didUnload")},getChildrenSize:function(){return this._children.length},clearChildren:function(){if(this._viewIDMap){for(var c in this._viewIDMap){var b=this._viewIDMap[c];this._removeChild(b)}}return this.clearChildrenByRange(0)},clearChildrenByRange:function(f,e){var b=this._children.length;if(b==0||f>=b||e<0){return true}if(f==undefined||f<0){f=0}if(e==undefined||e>=b){e=b-1}if(f>b){return false}for(var c=0,d=e-f;c<=d;c++){this._children[f].clearChildren();this.removeChildAt(f)}return true},clearFromParent:function(){this.clearChildren();this.removeFromParent()},removeFromParent:function(){if(!this._parent){return false}return this._parent.removeChild(this)},removeChild:function(b){return this.removeChildAt(this._children.indexOf(b))},removeChildAt:function(b){var d=this._children.length;if(b<0||b>=d.length){return null}var c=this._children.splice(b,1);if(!c||!c.length){return null}c=c[0];this._removeChild(c);return c},setStyle:function(b,c){this._checkElement();if(this._isInteger(c)&&a.View.cssNumber[b]){c=c+"px"}this._element.style[b]=c;return this},getStyle:function(b){this._checkElement();return window.getComputedStyle(this._element).getPropertyValue(b)},getAttribute:function(b){return this._element.getAttribute(b)},setAttribute:function(b,c){this._element.setAttribute(b,c);return this},attr:function(c,b){if(b===undefined){console.error("attr function is Deprecated, use getAttribute instead");return this._element.getAttribute(c)}else{console.error("attr function is Deprecated, use setAttribute instead");this._element.setAttribute(c,b);return this}},addClass:function(b){this._checkElement();this._element.classList.add(b);return this},removeClass:function(b){return this._element.classList.remove(b)},hasClass:function(b){return this._element.classList.contains(b)},bind:function(c,d,b){this._checkElement();this._viewEvents.bind(this._element,c,d,b)},unbind:function(b,c){this._checkElement();this._viewEvents.unbind(this._element,b,c)},getViewStatus:function(){if(!this._rendered){return"unrendered"}if(!this._parent){return"uninitialized"}return"initialized"},hide:function(){this._checkElement();if(this.getStyle("display")==="none"){return}this.setStyle("display","none");this.fire("hide");if(this._baseViewDelete&&this._baseViewDelete.viewDidHide){this._baseViewDelete.viewDidHide(this)}},visible:function(){var b=this.getStyle("display");return b!=="none"},show:function(){this._checkElement();if(this.getStyle("display")==="block"){return}this.setStyle("display",null);this.fire("show");if(this._baseViewDelete&&this._baseViewDelete.viewDidShow){this._baseViewDelete.viewDidShow(this)}},toggle:function(){if(this.getStyle("display")==="block"){this.hide();return"hide"}else{this.show();return"show"}},html:function(b){this._checkElement();if(b===undefined){return this._element.innerHTML}else{this._element.innerHTML=b;return this}return this._element.innerHTML},getTagName:function(){this._checkElement();return this._element.tagName},_isInteger:function(b){if(b==undefined){return 0}return(parseInt(b,10).toString()===b.toString())?1:0},startAnimation:function(){var b={};var d=container._children.length;container.addSubView(view);view.render();var c=this;startCSSAnimation(container,tarView,{didAnimationEnd:function(){if(c._animating===false){return}if(container._children.length>1){var e=container.getChildAt(0);e.clearFromParent()}c.render();c._animating=false;finish&&finish()}})},animate:function(c,b,e,d){}})}).run(function(a){a.View.cssNumber={width:true,height:true,top:true,left:true,columnCount:true,fillOpacity:true,fontWeight:true,lineHeight:true,opacity:true,orphans:true,widows:true,zIndex:true,zoom:true};(function(d){var f=function(i,h){a.View.prototype["get"+h]=function(){return this.getStyle(i)};a.View.prototype["set"+h]=function(j){this.setStyle(i,j)}};for(var c=0,g=d.length;c<g;c++){var e=d[c];var b=e.charAt(0).toUpperCase()+e.slice(1);f(e,b)}})(["height","width","top","left"]);if(!a.CommonUtil.haveClassList){a.View.prototype.addClass=function(d){this._checkElement();var c=this.attr("class");var b=null;if(!c){b=d}else{var e=c.split(" ");e[e.length]=d;b=e.join(" ")}this.attr("class",b);return this};a.View.prototype.removeClass=function(c){this._checkElement();var b=this.attr("class");if(b){if(b.indexOf(c)<0){return this}var d=b.split(" ");var e=d.indexOf(c);if(e>=0){newName=d.splice(0,e).join(" ");if(d.length>1){newName+=" "+d.splice(1).join("")}this.attr("class",newName)}}return this};a.View.prototype.hasClass=function(c){var b=this.attr("class");if(!b){return false}else{return(" "+b+" ").indexOf(" "+c+" ")>-1}}}return undefined});Package("tupai.ui").use("tupai.ui.View").define("TableView",function(a){return a.View.extend({_tableViewDelegate:undefined,initialize:function(b){a.View.prototype.initialize.apply(this,arguments);this._container=this},setTableViewDelegate:function(b){this._tableViewDelegate=b},dequeueReusableCell:function(b){return null},setFilter:function(b){this.iterateChildren(function(c){if(b(c)){c.show()}else{c.hide()}})},loadTopNewData:function(){return this.reloadRowsFrom()},loadBottomNewData:function(b){var d=this._numberOfRows||0;if(b!==undefined){var c=this._tableViewDelegate.numberOfRows(this);d-=(b-(c-d))}return this.reloadRowsFrom(d)},setContainerId:function(c){var b=this.findViewById(c);if(!b){throw new Error("can't find view by "+c)}this._container=b},_addSubView:function(b){this._container.addSubView(b)},reloadData:function(){return this.reloadRowsFrom(0)},reloadRowsFrom:function(f){if(f==undefined||f<0){f=0}var e=f;if(this._hasHeader){e++}if(!this._container.clearChildrenByRange(e)){return}if(this._tableViewDelegate.cellForRowAtTop){b=this._tableViewDelegate.cellForRowAtTop(this);if(b){if(!this._hasHeader){this._addSubView(b)}this._hasHeader=true}else{if(this._hasHeader){this.removeChildAt(0)}this._hasHeader=false}}var d=this._tableViewDelegate.numberOfRows(this);this._numberOfRows=d;if(f<d){for(var c=f;c<d;c++){var b=this._tableViewDelegate.cellForRowAtIndexPath({row:c},this);if(!b){throw new Error("you need return view by row "+c)}this._addSubView(b)}}if(this._tableViewDelegate.cellForRowAtBottom){b=this._tableViewDelegate.cellForRowAtBottom(this);b&&this._addSubView(b)}this._container.render()}})});Package("tupai.ui").use("tupai.ui.View").define("TemplateView",function(a){return a.View.extend({initialize:function(b){console.error("TemplateView is Deprecated, use View instead");a.View.prototype.initialize.apply(this,arguments)}})});Package("tupai.model.caches").use("tupai.util.MemCache").use("tupai.model.caches.QueueCacheDataSet").define("QueueCache",function(a){return Package.Class.extend({initialize:function(e,d,f){d=d||{};var b,h;if(d.memCache){var i=d.memCache;b=i.limit;h=i.overflowRemoveSize}this._storage=new a.MemCache(b,h);this._storage.setDelegate(this);this._attributes=d.attributes;if(d.localStorage){this._nativeStorage=window.localStorage}else{if(d.sessionStorage){this._nativeStorage=window.sessionStorage}}if(this._nativeStorage){this._nativeStorageKey="__tupai_"+e;var g=this._nativeStorage[this._nativeStorageKey];if(g){this._storage.swapStorage(JSON.parse(g))}}this._delegate=f;this._name=e},didMemCacheGC:function(){this._saveToNative();this._delegate&&this._delegate.didCacheGC&&this._delegate.didCacheGC(this._name,this)},getName:function(){return this._name},notifyDataSetChanged:function(b){this._saveToNative();this._delegate&&this._delegate.didCacheChanged&&this._delegate.didCacheChanged(this._name,this,b)},_saveToNative:function(){if(this._nativeStorage){this._nativeStorage[this._nativeStorageKey]=JSON.stringify(this._storage.getStorage())}},end:function(b){this.notifyDataSetChanged(b)},query:function(b){var c=new a.QueueCacheDataSet(this._storage,b);return c},getAttribute:function(b){return this._attributes&&this._attributes[b]},push:function(b){if(b instanceof Array){this._storage.concat(b)}else{this._storage.push(b)}},unshift:function(b){if(b instanceof Array){this._storage.concatFirst(b)}else{this._storage.unshift(b)}},filter:function(d,b){var c=this.size();this._storage.filter(d);if(!b&&this.size()!=c){this._delegate.didCacheChanged(this._name,this)}},iterator:function(b){this._storage.iterator(b)},remove:function(b){return this._storage.remove(b)},removeByElement:function(b){return this._storage.remove(b)},clear:function(){this._storage.clear()},get:function(b){return this._storage.get(b)},size:function(){return this._storage.size()}})});Package("tupai.model").use("tupai.events.Events").use("tupai.util.HashUtil").use("tupai.net.HttpClient").use("tupai.net.JsonpClient").use("tupai.net.HttpRequest").define("ApiManager",function(a){return Package.Class.extend({initialize:function(c){this._events=new a.Events();if(!c){throw new Error("missing config")}var d=c.client;this._client=this._createClient(c.client);var b=c.responseDelegate;if(b){this._responseDelegate=this._createResponseDelegate(b)}if(c.defaultRequestClasszz){console.error("defaultRequestClasszz is Deprecated, use requestClasszz instead")}this._requestClass=this._createClass(c.defaultRequestClasszz||c.requestClasszz,a.HttpRequest);this._requestParameterMap=c.apiParameterMap||{}},_createClass:function(c,b){if(c){if(typeof(c)==="string"){return Package.Class.forName(c)}else{if(typeof(c)==="function"){return c}else{throw new Error("cannot create class "+c)}}}else{return b}},_createResponseDelegate:function(c){var b=this._createClass(c.classzz);if(b){return new b(c.config)}else{return undefined}},_createClient:function(d){var c=d&&d.type;var b;if(c){if(c==="jsonp"){b=a.JsonpClient}else{if(c==="default"||c==="http"){b=a.HttpClient}else{throw new Error("unknow type "+c)}}}else{b=this._createClass(d&&d.classzz,a.HttpClient)}return new b(d&&d.config)},getRequestParameter:function(b,e){var d=this._requestParameterMap[b];if(!d){throw new Error("cannot find request for "+b+":"+e)}var c=d[e];if(!c){throw new Error("cannot find request for "+b+":"+e)}return c},createRequest:function(d){var c=this.getRequestParameter(d.name,d.requestName);var b=new this._requestClass(c);b.addAll(d);b.setName(d.name);b.setRequestName(d.requestName);return b},executeRequest:function(c,g,e,f,b){var d=this;this._client.execute(e,{didHttpRequestSuccess:function(h,i){d._responseDelegate&&d._responseDelegate.didHttpRequestSuccess&&d._responseDelegate.didHttpRequestSuccess(c,g,h,i);d.notify(c,g,"didHttpRequestSuccess",h,i);if(typeof(f)=="function"){f(c,g,h,i)}},didHttpRequestError:function(h,i){d._responseDelegate&&d._responseDelegate.didHttpRequestError&&d._responseDelegate.didHttpRequestError(c,g,h,i);d.notify(c,g,"didHttpRequestError",h,i);if(typeof(b)=="function"){b(c,g,h,i)}}})},execute:function(f,i,e,c,h,b){var g;if(typeof(f)==="object"){a.HashUtil.only("ApiManager.execute ",f,["managerName","name","requestName","parameters","queryParameters","formDatas","attributes","success","error"]);g=f}else{console.error("this parameter is Deprecated in ApiManager.execute");g={name:f,requestName:i,parameters:e,queryParameters:c,formDatas:h,attributes:b}}var d=this.createRequest(g);this.executeRequest(g.name,g.requestName,d,g.success,g.error)},registerObserver:function(c,b,d){this._events.addEventListener(c,b,d)},unRegisterObserver:function(c,b){this._events.removeEventListener(c,b)},notify:function(f,i,d,c,g,b){var h={name:f,requestName:i,response:c,request:g,attributes:b};this._events.fireDelegate(f,d,h)}})});Package("tupai").use("tupai.TransitManager").use("tupai.ui.View").use("tupai.TransitManager").define("Window",function(a){return a.View.extend({initialize:function(b){a.View.prototype.initialize.apply(this,[]);this._config=b||{};if(this._config.routes){this._transitManager=new a.TransitManager(this,b.routes);this._transitManager.setDelegate(this)}else{if(this._config.rootViewController){this._rootViewControllerClasszz=this._config.rootViewController}}},getConfig:function(b){if(b==undefined){return this._config}return this._config[b]},back:function(){if(!this._transitManager){return}this._transitManager.back.apply(this._transitManager,arguments)},transitWithHistory:function(){if(!this._transitManager){return}this._transitManager.transitWithHistory.apply(this._transitManager,arguments)},transit:function(){if(!this._transitManager){return}this._transitManager.transit.apply(this._transitManager,arguments)},showRoot:function(e,d){e=e||"/root";if(this._transitManager){return this.transit(e,d)}else{if(!this._rootViewControllerClasszz){throw new Error("missing root view controller.")}}var b=new this._rootViewControllerClasszz(this);var c;var f=e.lastIndexOf("/");if(f>=0){c=e.substring(f+1)}else{c=e}b.viewInit(d,e,c);this.transitController(b,e,d,{})},transitController:function(c,e,d,f){var b=c.getContentView();if(!b){throw new Error("cannot get contentView from ViewController")}this._displayView(b,f);this._currentController=c},getCurrentController:function(){return this._currentController},_displayView:function(b,d){this._startDisplayView=true;var e=this;var c=function(){if(e._finishDisplayQueue){var f=e._finishDisplayQueue;while((m=f.pop())){m()}}e.enableAction&&e.enableAction();e._startDisplayView=false};this.disableAction&&this.disableAction();if(d.animation!==false){this.clearChildren();this.addSubView(b);this.render();c()}},_displayViewWithAnimation:function(b,c){},doWhenFinishDisplay:function(b){if(this._startDisplayView){if(!this._finishDisplayQueue){this._finishDisplayQueue=[]}this._finishDisplayQueue.push(b)}else{b()}},_checkElement:function(){if(this._element){return}var c=this._config.winConfig;if(c){this._element=c.element}else{var b=document.querySelectorAll("*[data-ch-window]");if(!b||b.length<1){this._element=document.getElementsByTagName("body")[0]}else{this._element=b[0]}}},_onHTMLRender:function(){if(this._rendered){return false}this._rendered=true;return true},render:function(c){this._checkElement();var d=this._element;var b=this._onHTMLRender(d,c);this._onChildrenRender(c);if(b){this.didLoad&&this.didLoad()}}})});Package("tupai.model").use("tupai.events.Events").use("tupai.model.caches.QueueCache").use("tupai.model.caches.HashCache").define("CacheManager",function(a){return Package.Class.extend({initialize:function(c){this._events=new a.Events();this._caches={};if(c){for(var b in c){var d=c[b];this.createCache(b,d)}}},removeCache:function(b){if(this._caches[b]){delete this._caches[b]}},createCache:function(c,g){var f;var d=g.type;if(typeof(d)==="string"){if(d=="queue"){f=a.QueueCache}else{if(d==="hash"){f=a.HashCache}else{throw new Error("unkown cache type. "+d)}}}else{var e=g.classzz;if(!e){f=a.QueueCache}else{if(typeof(e)==="string"){f=Package.Class.forName(e)}else{if(typeof(e)==="function"){f=e}else{throw new Error("cannot create cache class "+e)}}}}var b=new f(c,g.config,this);this._caches[c]=b;return b},didCacheGC:function(b){this.notifyGC(b)},didCacheChanged:function(d,b,c){this.notifyChanged(d,c)},getCache:function(c){var b=this._caches[c];return b},cacheIterator:function(d){var b=this._caches;for(var c in b){d(c,b[c])}},getCacheNames:function(){var c=[];for(var b in this._caches){c.push(b)}return c},getAttribute:function(b,c){return this.getCache(b).getAttribute(c)},iterator:function(b,c){return this.getCache(b).iterator(c)},get:function(b,c){return this.getCache(b).get(c)},size:function(b){return this.getCache(b).size()},registerObserver:function(c,b,d){this._events.addEventListener(c,b,d)},unRegisterObserver:function(c,b){this._events.removeEventListener(c,b)},notifyGC:function(b){var c={name:b};this._events.fireDelegate(b,"didCacheGC",c)},notifyChanged:function(c,b){var d={name:c,options:b};this._events.fireDelegate(c,"didCacheChanged",d)}})});Package("tupai").use("tupai.events.Events").use("tupai.model.CacheManager").use("tupai.model.ApiManager").use("tupai.util.CommonUtil").use("tupai.Window").define("Application",function(a){return Package.Class.extend({_window:undefined,_delegate:undefined,_events:undefined,DEFAULT_WIN_ID:"default",initialize:function(b,c){this._setupWindows(b,c);this._delegate=c;if(b){this._attributes=b.attributes;this.addApiManagers(b.apiManagers);this.addApiManager(b.apiManager);this.setupCacheManager(b.cacheManager)}this._events=new a.Events();a.Application.instance=this;this._delegate&&this._delegate.didApplicationLoad&&this._delegate.didApplicationLoad()},_setupWindows:function(e,h){this._windows={};var j;if(e&&e.windows){j=function(i){return e.windows[i]}}else{j=function(l){var i=e&&e.window;return i||{}}}var k;if(h){k=function(n,l){var i=j(n);i.winConfig={element:l,id:n};return h.createWindow(i,n)}}else{k=function(n,l){var i=j(n);i.winConfig={element:l,id:n};return new a.Window(i)}}var b=document.querySelectorAll("*[data-ch-window]");if(!b||b.length<1){var f=document.getElementsByTagName("body")[0];this._windows[this.DEFAULT_WIN_ID]=k(this.DEFAULT_WIN_ID,f)}else{for(var g=0,d=b.length;g<d;g++){var f=b[g];var c=a.CommonUtil.getDataSet(f,"chWindow")||this.DEFAULT_WIN_ID;this._windows[c]=k(c,f)}}},setupCacheManager:function(b){if(!b){return}if(this._cacheManager){throw new Error("CacheManager has already setup.")}this._cacheManager=new a.CacheManager(b)},addApiManager:function(c,b){if(!c){return}if(!this._apiManagers){this._apiManagers={}}b=b||"default";this._apiManagers[b]=new a.ApiManager(c)},addApiManagers:function(c){if(!c){return}for(var b in c){this.addApiManager(c[b],b)}},getCacheManager:function(){return this._cacheManager},getCache:function(b){return this._cacheManager.getCache(b)},getApiManager:function(b){b=b||"default";return this._apiManagers[b]},setAttribute:function(c,d){if(!this._attributes){this._attributes={}}var b=this._attributes[c];this._attributes[c]=d;return b},getAttribute:function(b){return this._attributes&&this._attributes[b]},fire:function(b,c){this._events.fire(b,c)},addEventListener:function(b,c,d){this._events.addEventListener(b,c,d)},removeEventListener:function(b,c){this._events.removeEventListener(b,c)},close:function(){this._delegate&&this._delegate.didApplicationUnload&&this._delegate.didApplicationUnload()},getWindow:function(b){return this._windows[b||this.DEFAULT_WIN_ID]},show:function(c,b,e){var d=this._windows[e||this.DEFAULT_WIN_ID];d&&d.showRoot(c,b)}})});Package("tupai").use("tupai.Application").define("ViewController",function(a){return Package.Class.extend({_view:undefined,_window:undefined,_app:undefined,initialize:function(b){if(!b){throw new Error("no window")}this._window=b;this._app=a.Application.instance},getWindow:function(){return this._window},getApplication:function(){return this._app},registerCacheObserver:function(c,b,d){b=b||this;if(!this._cacheObservers){this._cacheObservers=[]}this._cacheObservers.push({name:c,observer:b});return this._app.getCacheManager().registerObserver(c,b,d)},unRegisterCacheObserver:function(c,b){b=b||this;return this._app.getCacheManager().unRegisterObserver(c,b)},registerApiObserver:function(c,b,f,d){var e=this._app.getApiManager(d);if(!e){throw new Error("can't found apiManager by name "+d)}b=b||this;if(!this._apiObservers){this._apiObservers=[]}this._apiObservers.push({managerName:d,name:c,observer:b});return e.registerObserver(c,b,f)},unRegisterApiObserver:function(c,b,d){var e=this._app.getApiManager(d);if(!e){throw new Error("can't found apiManager by name "+d)}b=b||this;return e.unRegisterObserver(c,b)},unRegisterObservers:function(){var b,d;if(this._cacheObservers){for(b=0,d=this._cacheObservers.length;b<d;b++){var c=this._cacheObservers[b];this.unRegisterCacheObserver(c.name,c.observer)}}if(this._apiObservers){for(b=0,d=this._apiObservers.length;b<d;b++){var c=this._apiObservers[b];this.unRegisterApiObserver(c.name,c.observer,c.managerName)}}},executeApi:function(b){if(!b){throw new Error("missing required parameter.")}var c=b.managerName;this._app.getApiManager(c).execute(b)},getCache:function(b){return this._app.getCache(b)},getContentView:function(){return this._view},setContentView:function(b){if(b){b.setDelegate(this)}this._view=b},getViewStatus:function(){if(!this._view){return null}return this._view.getViewStatus()},findViewById:function(){if(!this._view){return null}return this._view.findViewById.apply(this._view,arguments)},viewDidLoad:function(b){},viewDidUnload:function(b){this.unRegisterObservers()},viewInit:function(d,c,b){}})});